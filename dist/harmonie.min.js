!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).harmonie=i()}(this,(function(){"use strict";function t(i){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(i)}function i(t,i,s,e,a,n,r){try{var h=t[n](r),o=h.value}catch(t){return void s(t)}h.done?i(o):Promise.resolve(o).then(e,a)}function s(t){return function(){var s=this,e=arguments;return new Promise((function(a,n){var r=t.apply(s,e);function h(t){i(r,a,n,h,o,"next",t)}function o(t){i(r,a,n,h,o,"throw",t)}h(void 0)}))}}function e(t,i){return t(i={exports:{}},i.exports),i.exports}function a(t){return t&&t.default||t}var n=e((function(t,i){const s=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",e="["+s+"][:A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",a=new RegExp("^"+e+"$");i.isExist=function(t){return void 0!==t},i.isEmptyObject=function(t){return 0===Object.keys(t).length},i.merge=function(t,i,s){if(i){const e=Object.keys(i),a=e.length;for(let n=0;n<a;n++)t[e[n]]="strict"===s?[i[e[n]]]:i[e[n]]}},i.getValue=function(t){return i.isExist(t)?t:""},i.buildOptions=function(t,i,s){var e={};if(!t)return i;for(let a=0;a<s.length;a++)void 0!==t[s[a]]?e[s[a]]=t[s[a]]:e[s[a]]=i[s[a]];return e},i.isName=function(t){const i=a.exec(t);return!(null==i)},i.getAllMatches=function(t,i){const s=[];let e=i.exec(t);for(;e;){const a=[],n=e.length;for(let t=0;t<n;t++)a.push(e[t]);s.push(a),e=i.exec(t)}return s},i.nameRegexp=e}));n.isExist,n.isEmptyObject,n.merge,n.getValue,n.buildOptions,n.isName,n.getAllMatches,n.nameRegexp;const r=function(t,i){const s={};if(!(t.child&&!n.isEmptyObject(t.child)||t.attrsMap&&!n.isEmptyObject(t.attrsMap)))return n.isExist(t.val)?t.val:"";n.isExist(t.val)&&("string"!=typeof t.val||""!==t.val&&t.val!==i.cdataPositionChar)&&("strict"===i.arrayMode?s[i.textNodeName]=[t.val]:s[i.textNodeName]=t.val),n.merge(s,t.attrsMap,i.arrayMode);const e=Object.keys(t.child);for(let n=0;n<e.length;n++){var a=e[n];if(t.child[a]&&t.child[a].length>1)for(var h in s[a]=[],t.child[a])s[a].push(r(t.child[a][h],i));else if(!0===i.arrayMode){const e=r(t.child[a][0],i);s[a]="object"==typeof e?[e]:e}else"strict"===i.arrayMode?s[a]=[r(t.child[a][0],i)]:s[a]=r(t.child[a][0],i)}return s};var h={convertToJson:r},o=function(t,i,s){this.tagname=t,this.parent=i,this.child={},this.attrsMap={},this.val=s,this.addChild=function(t){Array.isArray(this.child[t.tagname])?this.child[t.tagname].push(t):this.child[t.tagname]=[t]}};const l=n.buildOptions,u=1,c=2,f=3,d=4,M="<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,n.nameRegexp);!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const p={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,ignoreNameSpace:!1,allowBooleanAttributes:!1,parseNodeValue:!0,parseAttributeValue:!1,arrayMode:!1,trimValues:!0,cdataTagName:!1,cdataPositionChar:"\\c",tagValueProcessor:function(t,i){return t},attrValueProcessor:function(t,i){return t},stopNodes:[]};var m=p;const g=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","ignoreNameSpace","allowBooleanAttributes","parseNodeValue","parseAttributeValue","arrayMode","trimValues","cdataTagName","cdataPositionChar","tagValueProcessor","attrValueProcessor","parseTrueNumberOnly","stopNodes"];var y=g;function v(t,i,s){const e=t[7]||s;let a=t[12];return a&&(i.trimValues&&(a=a.trim()),a=i.tagValueProcessor(a,e),a=x(a,i.parseNodeValue,i.parseTrueNumberOnly)),a}function b(t){return"]]>"===t[4]?d:"/"===t[10]?c:void 0!==t[8]&&"/"===t[8].substr(t[8].length-1)?f:u}function _(t,i){if(i.ignoreNameSpace){const i=t.split(":"),s="/"===t.charAt(0)?"/":"";if("xmlns"===i[0])return"";2===i.length&&(t=s+i[1])}return t}function x(t,i,s){if(i&&"string"==typeof t){let i;return""===t.trim()||isNaN(t)?i="true"===t||"false"!==t&&t:(-1!==t.indexOf("0x")?i=Number.parseInt(t,16):-1!==t.indexOf(".")?(i=Number.parseFloat(t),t=t.replace(/0+$/,"")):i=Number.parseInt(t,10),s&&(i=String(i)===t?i:t)),i}return n.isExist(t)?t:""}const w=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])(.*?)\\3)?","g");function N(t,i){if(!i.ignoreAttributes&&"string"==typeof t){t=t.replace(/\r?\n/g," ");const s=n.getAllMatches(t,w),e=s.length,a={};for(let t=0;t<e;t++){const e=_(s[t][1],i);e.length&&(void 0!==s[t][4]?(i.trimValues&&(s[t][4]=s[t][4].trim()),s[t][4]=i.attrValueProcessor(s[t][4],e),a[i.attributeNamePrefix+e]=x(s[t][4],i.parseAttributeValue,i.parseTrueNumberOnly)):i.allowBooleanAttributes&&(a[i.attributeNamePrefix+e]=!0))}if(!Object.keys(a).length)return;if(i.attrNodeName){const t={};return t[i.attrNodeName]=a,t}return a}}var C={defaultOptions:m,props:y,getTraversalObj:function(t,i){i=l(i,p,g),t=t.replace(/<!--[\s\S]*?-->/g,"");const s=new o("!xml");let e=s;const a=new RegExp(M,"g");let r=a.exec(t),h=a.exec(t);for(;r;){const s=b(r);if(s===c)e.parent&&r[12]&&(e.parent.val=n.getValue(e.parent.val)+""+v(r,i,e.parent.tagname)),i.stopNodes.length&&i.stopNodes.includes(e.tagname)&&(e.child=[],null==e.attrsMap&&(e.attrsMap={}),e.val=t.substr(e.startIndex+1,r.index-e.startIndex-1)),e=e.parent;else if(s===d)if(i.cdataTagName){const t=new o(i.cdataTagName,e,r[3]);t.attrsMap=N(r[8],i),e.addChild(t),e.val=n.getValue(e.val)+i.cdataPositionChar,r[12]&&(e.val+=v(r,i))}else e.val=(e.val||"")+(r[3]||"")+v(r,i);else if(s===f){e&&r[12]&&(e.val=n.getValue(e.val)+""+v(r,i));const t=new o(i.ignoreNameSpace?r[7]:r[5],e,"");r[8]&&r[8].length>0&&(r[8]=r[8].substr(0,r[8].length-1)),t.attrsMap=N(r[8],i),e.addChild(t)}else{const t=new o(i.ignoreNameSpace?r[7]:r[5],e,v(r,i));i.stopNodes.length&&i.stopNodes.includes(t.tagname)&&(t.startIndex=r.index+r[1].length),t.attrsMap=N(r[8],i),e.addChild(t),e=t}r=h,h=a.exec(t)}return s}};const P={allowBooleanAttributes:!1},S=["allowBooleanAttributes"];function A(t,i){for(var s=i;i<t.length;i++)if("?"!=t[i]&&" "!=t[i]);else{var e=t.substr(s,i-s);if(i>5&&"xml"===e)return j("InvalidXml","XML declaration allowed only at the start of the document.",R(t,i));if("?"==t[i]&&">"==t[i+1]){i++;break}}return i}function E(t,i){if(t.length>i+5&&"-"===t[i+1]&&"-"===t[i+2]){for(i+=3;i<t.length;i++)if("-"===t[i]&&"-"===t[i+1]&&">"===t[i+2]){i+=2;break}}else if(t.length>i+8&&"D"===t[i+1]&&"O"===t[i+2]&&"C"===t[i+3]&&"T"===t[i+4]&&"Y"===t[i+5]&&"P"===t[i+6]&&"E"===t[i+7]){let s=1;for(i+=8;i<t.length;i++)if("<"===t[i])s++;else if(">"===t[i]&&(s--,0===s))break}else if(t.length>i+9&&"["===t[i+1]&&"C"===t[i+2]&&"D"===t[i+3]&&"A"===t[i+4]&&"T"===t[i+5]&&"A"===t[i+6]&&"["===t[i+7])for(i+=8;i<t.length;i++)if("]"===t[i]&&"]"===t[i+1]&&">"===t[i+2]){i+=2;break}return i}function O(t,i){let s="",e="",a=!1;for(;i<t.length;i++){if('"'===t[i]||"'"===t[i])if(""===e)e=t[i];else{if(e!==t[i])continue;e=""}else if(">"===t[i]&&""===e){a=!0;break}s+=t[i]}return""===e&&{value:s,index:i,tagClosed:a}}const k=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function I(t,i){const s=n.getAllMatches(t,k),e={};for(let a=0;a<s.length;a++){if(0===s[a][1].length)return j("InvalidAttr",`Attribute '${s[a][2]}' has no space in starting.`,F(t,s[a][0]));if(void 0===s[a][3]&&!i.allowBooleanAttributes)return j("InvalidAttr",`boolean attribute '${s[a][2]}' is not allowed.`,F(t,s[a][0]));const n=s[a][2];if(!q(n))return j("InvalidAttr",`Attribute '${n}' is an invalid name.`,F(t,s[a][0]));if(e.hasOwnProperty(n))return j("InvalidAttr",`Attribute '${n}' is repeated.`,F(t,s[a][0]));e[n]=1}return!0}function T(t,i){if(";"===t[++i])return-1;if("#"===t[i])return function(t,i){let s=/\d/;for("x"===t[i]&&(i++,s=/[\da-fA-F]/);i<t.length;i++){if(";"===t[i])return i;if(!t[i].match(s))break}return-1}(t,++i);let s=0;for(;i<t.length;i++,s++)if(!(t[i].match(/\w/)&&s<20)){if(";"===t[i])break;return-1}return i}function j(t,i,s){return{err:{code:t,msg:i,line:s}}}function q(t){return n.isName(t)}function R(t,i){return t.substring(0,i).split(/\r?\n/).length}function F(t,i){return t.indexOf(i)+i.length}var D=function(t,i){i=n.buildOptions(i,P,S);const s=[];let e=!1,a=!1;"\ufeff"===t[0]&&(t=t.substr(1));for(let h=0;h<t.length;h++){if("<"!==t[h]){if(" "===t[h]||"\t"===t[h]||"\n"===t[h]||"\r"===t[h])continue;return j("InvalidChar",`char '${t[h]}' is not expected.`,R(t,h))}if(h++,"?"===t[h]){if(h=A(t,++h),h.err)return h}else{if("!"===t[h]){h=E(t,h);continue}{let o=!1;"/"===t[h]&&(o=!0,h++);let l="";for(;h<t.length&&">"!==t[h]&&" "!==t[h]&&"\t"!==t[h]&&"\n"!==t[h]&&"\r"!==t[h];h++)l+=t[h];if(l=l.trim(),"/"===l[l.length-1]&&(l=l.substring(0,l.length-1),h--),r=l,!n.isName(r)){let i;return i=0===l.trim().length?"There is an unnecessary space between tag name and backward slash '</ ..'.":`Tag '${l}' is an invalid name.`,j("InvalidTag",i,R(t,h))}const u=O(t,h);if(!1===u)return j("InvalidAttr",`Attributes for '${l}' have open quote.`,R(t,h));let c=u.value;if(h=u.index,"/"===c[c.length-1]){c=c.substring(0,c.length-1);const s=I(c,i);if(!0!==s)return j(s.err.code,s.err.msg,R(t,h-c.length+s.err.line));e=!0}else if(o){if(!u.tagClosed)return j("InvalidTag",`Closing tag '${l}' doesn't have proper closing.`,R(t,h));if(c.trim().length>0)return j("InvalidTag",`Closing tag '${l}' can't have attributes or invalid starting.`,R(t,h));{const i=s.pop();if(l!==i)return j("InvalidTag",`Closing tag '${i}' is expected inplace of '${l}'.`,R(t,h));0==s.length&&(a=!0)}}else{const n=I(c,i);if(!0!==n)return j(n.err.code,n.err.msg,R(t,h-c.length+n.err.line));if(!0===a)return j("InvalidXml","Multiple possible root nodes found.",R(t,h));s.push(l),e=!0}for(h++;h<t.length;h++){if("<"===t[h]){if("!"===t[h+1]){h++,h=E(t,h);continue}break}if("&"===t[h]){const i=T(t,h);if(-1==i)return j("InvalidChar","char '&' is not expected.",R(t,h));h=i}}"<"===t[h]&&h--}}}var r;return e?!(s.length>0)||j("InvalidXml",`Invalid '${JSON.stringify(s,null,4).replace(/\r?\n/g,"")}' found.`,1):j("InvalidXml","Start tag expected.",1)};const L=function(t){return String.fromCharCode(t)},G={nilChar:L(176),missingChar:L(201),nilPremitive:L(175),missingPremitive:L(200),emptyChar:L(178),emptyValue:L(177),boundryChar:L(179),objStart:L(198),arrStart:L(204),arrayEnd:L(185)},z=[G.nilChar,G.nilPremitive,G.missingChar,G.missingPremitive,G.boundryChar,G.emptyChar,G.emptyValue,G.arrayEnd,G.objStart,G.arrStart],B=function(t,i,s){if("string"==typeof i)return t&&t[0]&&void 0!==t[0].val?U(t[0].val):U(t);{const a=void 0===(e=t)?G.missingChar:null===e?G.nilChar:!(e.child&&0===Object.keys(e.child).length&&(!e.attrsMap||0===Object.keys(e.attrsMap).length))||G.emptyChar;if(!0===a){let e="";if(Array.isArray(i)){e+=G.arrStart;const a=i[0],n=t.length;if("string"==typeof a)for(let i=0;i<n;i++){const s=U(t[i].val);e=V(e,s)}else for(let i=0;i<n;i++){const n=B(t[i],a,s);e=V(e,n)}e+=G.arrayEnd}else{e+=G.objStart;const a=Object.keys(i);Array.isArray(t)&&(t=t[0]);for(let n in a){const r=a[n];let h;h=!s.ignoreAttributes&&t.attrsMap&&t.attrsMap[r]?B(t.attrsMap[r],i[r],s):r===s.textNodeName?B(t.val,i[r],s):B(t.child[r],i[r],s),e=V(e,h)}}return e}return a}var e},U=function(t){switch(t){case void 0:return G.missingPremitive;case null:return G.nilPremitive;case"":return G.emptyValue;default:return t}},V=function(t,i){return J(i[0])||J(t[t.length-1])||(t+=G.boundryChar),t+i},J=function(t){return-1!==z.indexOf(t)};const Q=n.buildOptions;var W={convert2nimn:function(t,i,s){return s=Q(s,C.defaultOptions,C.props),B(t,i,s)}};const X=n.buildOptions,H=function(t,i,s){let e="{";const a=Object.keys(t.child);for(let s=0;s<a.length;s++){var r=a[s];if(t.child[r]&&t.child[r].length>1){for(var h in e+='"'+r+'" : [ ',t.child[r])e+=H(t.child[r][h],i)+" , ";e=e.substr(0,e.length-1)+" ] "}else e+='"'+r+'" : '+H(t.child[r][0],i)+" ,"}return n.merge(e,t.attrsMap),n.isEmptyObject(e)?n.isExist(t.val)?t.val:"":(n.isExist(t.val)&&("string"!=typeof t.val||""!==t.val&&t.val!==i.cdataPositionChar)&&(e+='"'+i.textNodeName+'" : '+(!0!==(o=t.val)&&!1!==o&&isNaN(o)?'"'+o+'"':o)),","===e[e.length-1]&&(e=e.substr(0,e.length-2)),e+"}");var o};var $={convertToJsonString:function(t,i){return(i=X(i,C.defaultOptions,C.props)).indentBy=i.indentBy||"",H(t,i)}};const K=n.buildOptions,Z={attributeNamePrefix:"@_",attrNodeName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataTagName:!1,cdataPositionChar:"\\c",format:!1,indentBy:"  ",supressEmptyNode:!1,tagValueProcessor:function(t){return t},attrValueProcessor:function(t){return t}},Y=["attributeNamePrefix","attrNodeName","textNodeName","ignoreAttributes","cdataTagName","cdataPositionChar","format","indentBy","supressEmptyNode","tagValueProcessor","attrValueProcessor"];function tt(t){this.options=K(t,Z,Y),this.options.ignoreAttributes||this.options.attrNodeName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=ot),this.options.cdataTagName?this.isCDATA=lt:this.isCDATA=function(){return!1},this.replaceCDATAstr=it,this.replaceCDATAarr=st,this.options.format?(this.indentate=ht,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.supressEmptyNode?(this.buildTextNode=rt,this.buildObjNode=at):(this.buildTextNode=nt,this.buildObjNode=et),this.buildTextValNode=nt,this.buildObjectNode=et}function it(t,i){return t=this.options.tagValueProcessor(""+t),""===this.options.cdataPositionChar||""===t?t+"<![CDATA["+i+"]]"+this.tagEndChar:t.replace(this.options.cdataPositionChar,"<![CDATA["+i+"]]"+this.tagEndChar)}function st(t,i){if(t=this.options.tagValueProcessor(""+t),""===this.options.cdataPositionChar||""===t)return t+"<![CDATA["+i.join("]]><![CDATA[")+"]]"+this.tagEndChar;for(let s in i)t=t.replace(this.options.cdataPositionChar,"<![CDATA["+i[s]+"]]>");return t+this.newLine}function et(t,i,s,e){return s&&!t.includes("<")?this.indentate(e)+"<"+i+s+">"+t+"</"+i+this.tagEndChar:this.indentate(e)+"<"+i+s+this.tagEndChar+t+this.indentate(e)+"</"+i+this.tagEndChar}function at(t,i,s,e){return""!==t?this.buildObjectNode(t,i,s,e):this.indentate(e)+"<"+i+s+"/"+this.tagEndChar}function nt(t,i,s,e){return this.indentate(e)+"<"+i+s+">"+this.options.tagValueProcessor(t)+"</"+i+this.tagEndChar}function rt(t,i,s,e){return""!==t?this.buildTextValNode(t,i,s,e):this.indentate(e)+"<"+i+s+"/"+this.tagEndChar}function ht(t){return this.options.indentBy.repeat(t)}function ot(t){return!!t.startsWith(this.options.attributeNamePrefix)&&t.substr(this.attrPrefixLen)}function lt(t){return t===this.options.cdataTagName}tt.prototype.parse=function(t){return this.j2x(t,0).val},tt.prototype.j2x=function(t,i){let s="",e="";const a=Object.keys(t),n=a.length;for(let r=0;r<n;r++){const n=a[r];if(void 0===t[n]);else if(null===t[n])e+=this.indentate(i)+"<"+n+"/"+this.tagEndChar;else if(t[n]instanceof Date)e+=this.buildTextNode(t[n],n,"",i);else if("object"!=typeof t[n]){const a=this.isAttribute(n);a?s+=" "+a+'="'+this.options.attrValueProcessor(""+t[n])+'"':this.isCDATA(n)?t[this.options.textNodeName]?e+=this.replaceCDATAstr(t[this.options.textNodeName],t[n]):e+=this.replaceCDATAstr("",t[n]):n===this.options.textNodeName?t[this.options.cdataTagName]||(e+=this.options.tagValueProcessor(""+t[n])):e+=this.buildTextNode(t[n],n,"",i)}else if(Array.isArray(t[n]))if(this.isCDATA(n))e+=this.indentate(i),t[this.options.textNodeName]?e+=this.replaceCDATAarr(t[this.options.textNodeName],t[n]):e+=this.replaceCDATAarr("",t[n]);else{const s=t[n].length;for(let a=0;a<s;a++){const s=t[n][a];if(void 0===s);else if(null===s)e+=this.indentate(i)+"<"+n+"/"+this.tagEndChar;else if("object"==typeof s){const t=this.j2x(s,i+1);e+=this.buildObjNode(t.val,n,t.attrStr,i)}else e+=this.buildTextNode(s,n,"",i)}}else if(this.options.attrNodeName&&n===this.options.attrNodeName){const i=Object.keys(t[n]),e=i.length;for(let a=0;a<e;a++)s+=" "+i[a]+'="'+this.options.attrValueProcessor(""+t[n][i[a]])+'"'}else{const s=this.j2x(t[n],i+1);e+=this.buildObjNode(s.val,n,s.attrStr,i)}}return{attrStr:s,val:e}};var ut=tt,ct=e((function(t,i){const s=C,e=n.buildOptions;i.parse=function(t,i,a){if(a){!0===a&&(a={});const i=D(t,a);if(!0!==i)throw Error(i.err.msg)}return i=e(i,s.defaultOptions,s.props),h.convertToJson(C.getTraversalObj(t,i),i)},i.convertTonimn=W.convert2nimn,i.getTraversalObj=C.getTraversalObj,i.convertToJson=h.convertToJson,i.convertToJsonString=$.convertToJsonString,i.validate=D,i.j2xParser=ut,i.parseToNimn=function(t,s,e){return i.convertTonimn(i.getTraversalObj(t,e),s,e)}}));ct.parse,ct.convertTonimn,ct.getTraversalObj,ct.convertToJson,ct.convertToJsonString,ct.validate,ct.j2xParser,ct.parseToNimn;function ft(t){return new dt(t instanceof Uint8Array?t:new Uint8Array(t))}function dt(t){this._array=t}function Mt(t){return fetch(t).then((function(t){return t.body&&t.body.getReader?t.body.getReader():t.arrayBuffer().then(ft)}))}function pt(t){return new Promise((function(i,s){var e=new XMLHttpRequest;e.responseType="arraybuffer",e.onload=function(){i(ft(e.response))},e.onerror=s,e.ontimeout=s,e.open("GET",t,!0),e.send()}))}function mt(t){return("function"==typeof fetch?Mt:pt)(t)}function gt(t){return"function"==typeof t.read?t:t.getReader()}dt.prototype.read=function(){var t=this._array;return this._array=null,Promise.resolve(t?{done:!1,value:t}:{done:!0,value:void 0})},dt.prototype.cancel=function(){return this._array=null,Promise.resolve()};var yt=new Uint8Array(0);function vt(t,i){if(!t.length)return i;if(!i.length)return t;var s=new Uint8Array(t.length+i.length);return s.set(t),s.set(i,t.length),s}function bt(t){return"function"==typeof t.slice?t:new _t("function"==typeof t.read?t:t.getReader())}function _t(t){this._source=t,this._array=yt,this._index=0}function xt(t){return!(t=t.trim())||isNaN(t=+t)?null:t}_t.prototype.read=function(){var t=this,i=t._array.subarray(t._index);return t._source.read().then((function(s){return t._array=yt,t._index=0,s.done?i.length>0?{done:!1,value:i}:{done:!0,value:void 0}:{done:!1,value:vt(i,s.value)}}))},_t.prototype.slice=function(t){if((t|=0)<0)throw new Error("invalid length");var i=this,s=this._array.length-this._index;if(this._index+t<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=t));var e=new Uint8Array(t);return e.set(this._array.subarray(this._index)),function a(){return i._source.read().then((function(n){return n.done?(i._array=yt,i._index=0,s>0?e.subarray(0,s):null):s+n.value.length>=t?(i._array=n.value,i._index=t-s,e.set(n.value.subarray(0,t-s),s),e):(e.set(n.value,s),s+=n.value.length,a())}))}()},_t.prototype.cancel=function(){return this._source.cancel()};var wt={B:xt,C:function(t){return t.trim()||null},D:function(t){return new Date(+t.substring(0,4),t.substring(4,6)-1,+t.substring(6,8))},F:xt,L:function(t){return!/^[nf]$/i.test(t)&&(!!/^[yt]$/i.test(t)||null)},M:xt,N:xt};function Nt(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function Ct(t,i){return(t=bt(t)).slice(32).then((function(s){var e=Nt(s);return t.slice(e.getUint16(8,!0)-32).then((function(s){return new Pt(t,i,e,Nt(s))}))}))}function Pt(t,i,s,e){this._source=t,this._decode=i.decode.bind(i),this._recordLength=s.getUint16(10,!0),this._fields=[];for(var a=0;13!==e.getUint8(a);a+=32){for(var n=0;n<11&&0!==e.getUint8(a+n);++n);this._fields.push({name:this._decode(new Uint8Array(e.buffer,e.byteOffset+a,n)),type:String.fromCharCode(e.getUint8(a+11)),length:e.getUint8(a+16)})}}var St=Pt.prototype;function At(t){var i,s=40,e=t.getInt32(36,!0),a=new Array(e);for(i=0;i<e;++i,s+=16)a[i]=[t.getFloat64(s,!0),t.getFloat64(s+8,!0)];return{type:"MultiPoint",coordinates:a}}function Et(t){return{type:"Point",coordinates:[t.getFloat64(4,!0),t.getFloat64(12,!0)]}}function Ot(t){var i,s=44,e=t.getInt32(36,!0),a=t.getInt32(40,!0),n=new Array(e),r=new Array(a),h=[],o=[];for(i=0;i<e;++i,s+=4)n[i]=t.getInt32(s,!0);for(i=0;i<a;++i,s+=16)r[i]=[t.getFloat64(s,!0),t.getFloat64(s+8,!0)];return n.forEach((function(t,i){var s=r.slice(t,n[i+1]);!function(t){if((i=t.length)<4)return!1;var i,s=0,e=t[i-1][1]*t[0][0]-t[i-1][0]*t[0][1];for(;++s<i;)e+=t[s-1][1]*t[s][0]-t[s-1][0]*t[s][1];return e>=0}(s)?o.push(s):h.push([s])})),o.forEach((function(t){h.some((function(i){if(function(t,i){var s,e=-1,a=i.length;for(;++e<a;)if(s=kt(t,i[e]))return s>0;return!1}(i[0],t))return i.push(t),!0}))||h.push([t])})),1===h.length?{type:"Polygon",coordinates:h[0]}:{type:"MultiPolygon",coordinates:h}}function kt(t,i){for(var s=i[0],e=i[1],a=-1,n=0,r=t.length,h=r-1;n<r;h=n++){var o=t[n],l=o[0],u=o[1],c=t[h],f=c[0],d=c[1];if(It(o,c,i))return 0;u>e!=d>e&&s<(f-l)*(e-u)/(d-u)+l&&(a=-a)}return a}function It(t,i,s){var e=s[0]-t[0],a=s[1]-t[1];if(0===e&&0===a)return!0;var n=i[0]-t[0],r=i[1]-t[1];if(0===n&&0===r)return!1;var h=(e*n+a*r)/(n*n+r*r);return!(h<0||h>1)&&(0===h||1===h||h*n===e&&h*r===a)}function Tt(t){var i,s=44,e=t.getInt32(36,!0),a=t.getInt32(40,!0),n=new Array(e),r=new Array(a);for(i=0;i<e;++i,s+=4)n[i]=t.getInt32(s,!0);for(i=0;i<a;++i,s+=16)r[i]=[t.getFloat64(s,!0),t.getFloat64(s+8,!0)];return 1===e?{type:"LineString",coordinates:r}:{type:"MultiLineString",coordinates:n.map((function(t,i){return r.slice(t,n[i+1])}))}}function jt(t,i){var s=new Uint8Array(t.length+i.length);return s.set(t,0),s.set(i,t.length),s}St.read=function(){var t=this,i=1;return t._source.slice(t._recordLength).then((function(s){return s&&26!==s[0]?{done:!1,value:t._fields.reduce((function(e,a){return e[a.name]=wt[a.type](t._decode(s.subarray(i,i+=a.length))),e}),{})}:{done:!0,value:void 0}}))},St.cancel=function(){return this._source.cancel()};var qt={0:function(){return null},1:Et,3:Tt,5:Ot,8:At,11:Et,13:Tt,15:Ot,18:At,21:Et,23:Tt,25:Ot,28:At};function Rt(t){return(t=bt(t)).slice(100).then((function(i){return new Ft(t,Nt(i))}))}function Ft(t,i){var s=i.getInt32(32,!0);if(!(s in qt))throw new Error("unsupported shape type: "+s);this._source=t,this._type=s,this._index=0,this._parse=qt[s],this.bbox=[i.getFloat64(36,!0),i.getFloat64(44,!0),i.getFloat64(52,!0),i.getFloat64(60,!0)]}var Dt=Ft.prototype;function Lt(){}function Gt(t,i,s){return Promise.all([Rt(t),i&&Ct(i,s)]).then((function(t){return new zt(t[0],t[1])}))}function zt(t,i){this._shp=t,this._dbf=i,this.bbox=t.bbox}Dt.read=function(){var t=this;return++t._index,t._source.slice(12).then((function(i){if(null==i)return{done:!0,value:void 0};var s=Nt(i);function e(){var a=2*s.getInt32(4,!1)-4,n=s.getInt32(8,!0);return a<0||n&&n!==t._type?function a(){return t._source.slice(4).then((function(n){return null==n?{done:!0,value:void 0}:(s=Nt(i=jt(i.slice(4),n))).getInt32(0,!1)!==t._index?a():e()}))}():t._source.slice(a).then((function(s){return{done:!1,value:n?t._parse(Nt(jt(i.slice(8),s))):null}}))}return e()}))},Dt.cancel=function(){return this._source.cancel()};var Bt=zt.prototype;function Ut(t,i,s){return"string"==typeof i?(/\.dbf$/.test(i)||(i+=".dbf"),i=mt(i)):i instanceof ArrayBuffer||i instanceof Uint8Array?i=ft(i):null!=i&&(i=gt(i)),"string"==typeof t?(/\.shp$/.test(t)||(t+=".shp"),void 0===i&&(i=mt(t.substring(0,t.length-4)+".dbf").catch((function(){}))),t=mt(t)):t=t instanceof ArrayBuffer||t instanceof Uint8Array?ft(t):gt(t),Promise.all([t,i]).then((function(t){var i=t[0],e=t[1],a="windows-1252";return s&&null!=s.encoding&&(a=s.encoding),Gt(i,e,e&&new TextDecoder(a))}))}Bt.read=function(){return Promise.all([this._dbf?this._dbf.read():{value:{}},this._shp.read()]).then((function(t){var i=t[0],s=t[1];return s.done?s:{done:!1,value:{type:"Feature",properties:i.value,geometry:s.value}}}))},Bt.cancel=function(){return Promise.all([this._dbf&&this._dbf.cancel(),this._shp.cancel()]).then(Lt)};var Vt=Object.freeze({__proto__:null,open:Ut,openShp:function(t,i){return"string"==typeof t?(/\.shp$/.test(t)||(t+=".shp"),t=mt(t)):t=t instanceof ArrayBuffer||t instanceof Uint8Array?ft(t):gt(t),Promise.resolve(t).then(Rt)},openDbf:function(t,i){var s="windows-1252";return i&&null!=i.encoding&&(s=i.encoding),s=new TextDecoder(s),"string"==typeof t?(/\.dbf$/.test(t)||(t+=".dbf"),t=mt(t)):t=t instanceof ArrayBuffer||t instanceof Uint8Array?ft(t):gt(t),Promise.resolve(t).then((function(t){return Ct(t,s)}))},read:function(t,i,s){return Ut(t,i,s).then((function(t){var i=[],s={type:"FeatureCollection",features:i,bbox:t.bbox};return t.read().then((function e(a){return a.done?s:(i.push(a.value),t.read().then(e))}))}))}});var Jt=484813681109536e-20,Qt=Math.PI/2,Wt=.017453292519943295,Xt=57.29577951308232,Ht=Math.PI/4,$t=2*Math.PI,Kt=3.14159265359,Zt={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667},Yt={ft:{to_meter:.3048},"us-ft":{to_meter:1200/3937}},ti=/[\s_\-\/\(\)]/g;function ii(t,i){if(t[i])return t[i];for(var s,e=Object.keys(t),a=i.toLowerCase().replace(ti,""),n=-1;++n<e.length;)if((s=e[n]).toLowerCase().replace(ti,"")===a)return t[s]}function si(t){var i,s,e,a={},n=t.split("+").map((function(t){return t.trim()})).filter((function(t){return t})).reduce((function(t,i){var s=i.split("=");return s.push(!0),t[s[0].toLowerCase()]=s[1],t}),{}),r={proj:"projName",datum:"datumCode",rf:function(t){a.rf=parseFloat(t)},lat_0:function(t){a.lat0=t*Wt},lat_1:function(t){a.lat1=t*Wt},lat_2:function(t){a.lat2=t*Wt},lat_ts:function(t){a.lat_ts=t*Wt},lon_0:function(t){a.long0=t*Wt},lon_1:function(t){a.long1=t*Wt},lon_2:function(t){a.long2=t*Wt},alpha:function(t){a.alpha=parseFloat(t)*Wt},lonc:function(t){a.longc=t*Wt},x_0:function(t){a.x0=parseFloat(t)},y_0:function(t){a.y0=parseFloat(t)},k_0:function(t){a.k0=parseFloat(t)},k:function(t){a.k0=parseFloat(t)},a:function(t){a.a=parseFloat(t)},b:function(t){a.b=parseFloat(t)},r_a:function(){a.R_A=!0},zone:function(t){a.zone=parseInt(t,10)},south:function(){a.utmSouth=!0},towgs84:function(t){a.datum_params=t.split(",").map((function(t){return parseFloat(t)}))},to_meter:function(t){a.to_meter=parseFloat(t)},units:function(t){a.units=t;var i=ii(Yt,t);i&&(a.to_meter=i.to_meter)},from_greenwich:function(t){a.from_greenwich=t*Wt},pm:function(t){var i=ii(Zt,t);a.from_greenwich=(i||parseFloat(t))*Wt},nadgrids:function(t){"@null"===t?a.datumCode="none":a.nadgrids=t},axis:function(t){3===t.length&&-1!=="ewnsud".indexOf(t.substr(0,1))&&-1!=="ewnsud".indexOf(t.substr(1,1))&&-1!=="ewnsud".indexOf(t.substr(2,1))&&(a.axis=t)}};for(i in n)s=n[i],i in r?"function"==typeof(e=r[i])?e(s):a[e]=s:a[i]=s;return"string"==typeof a.datumCode&&"WGS84"!==a.datumCode&&(a.datumCode=a.datumCode.toLowerCase()),a}var ei=/\s/,ai=/[A-Za-z]/,ni=/[A-Za-z84]/,ri=/[,\]]/,hi=/[\d\.E\-\+]/;function oi(t){if("string"!=typeof t)throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=1}function li(t,i,s){Array.isArray(i)&&(s.unshift(i),i=null);var e=i?{}:t,a=s.reduce((function(t,i){return ui(i,t),t}),e);i&&(t[i]=a)}function ui(t,i){if(Array.isArray(t)){var s,e=t.shift();if("PARAMETER"===e&&(e=t.shift()),1===t.length)return Array.isArray(t[0])?(i[e]={},void ui(t[0],i[e])):void(i[e]=t[0]);if(t.length)if("TOWGS84"!==e)switch(Array.isArray(e)||(i[e]={}),e){case"UNIT":case"PRIMEM":case"VERT_DATUM":return i[e]={name:t[0].toLowerCase(),convert:t[1]},void(3===t.length&&ui(t[2],i[e]));case"SPHEROID":case"ELLIPSOID":return i[e]={name:t[0],a:t[1],rf:t[2]},void(4===t.length&&ui(t[3],i[e]));case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"EDATUM":case"ENGINEERINGDATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":case"COMPD_CS":case"COMPOUNDCRS":case"ENGINEERINGCRS":case"ENGCRS":case"FITTED_CS":case"LOCAL_DATUM":case"DATUM":return t[0]=["name",t[0]],void li(i,e,t);default:for(s=-1;++s<t.length;)if(!Array.isArray(t[s]))return ui(t,i[e]);return li(i,e,t)}else i[e]=t;else i[e]=!0}else i[t]=!0}oi.prototype.readCharicter=function(){var t=this.text[this.place++];if(4!==this.state)for(;ei.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case 1:return this.neutral(t);case 2:return this.keyword(t);case 4:return this.quoted(t);case 5:return this.afterquote(t);case 3:return this.number(t);case-1:return}},oi.prototype.afterquote=function(t){if('"'===t)return this.word+='"',void(this.state=4);if(ri.test(t))return this.word=this.word.trim(),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in afterquote yet, index '+this.place)},oi.prototype.afterItem=function(t){return","===t?(null!==this.word&&this.currentObject.push(this.word),this.word=null,void(this.state=1)):"]"===t?(this.level--,null!==this.word&&(this.currentObject.push(this.word),this.word=null),this.state=1,this.currentObject=this.stack.pop(),void(this.currentObject||(this.state=-1))):void 0},oi.prototype.number=function(t){if(!hi.test(t)){if(ri.test(t))return this.word=parseFloat(this.word),void this.afterItem(t);throw new Error("havn't handled \""+t+'" in number yet, index '+this.place)}this.word+=t},oi.prototype.quoted=function(t){'"'!==t?this.word+=t:this.state=5},oi.prototype.keyword=function(t){if(ni.test(t))this.word+=t;else{if("["===t){var i=[];return i.push(this.word),this.level++,null===this.root?this.root=i:this.currentObject.push(i),this.stack.push(this.currentObject),this.currentObject=i,void(this.state=1)}if(!ri.test(t))throw new Error("havn't handled \""+t+'" in keyword yet, index '+this.place);this.afterItem(t)}},oi.prototype.neutral=function(t){if(ai.test(t))return this.word=t,void(this.state=2);if('"'===t)return this.word="",void(this.state=4);if(hi.test(t))return this.word=t,void(this.state=3);if(!ri.test(t))throw new Error("havn't handled \""+t+'" in neutral yet, index '+this.place);this.afterItem(t)},oi.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(-1===this.state)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function ci(t){return.017453292519943295*t}function fi(t){var i=new oi(t).output(),s=i.shift(),e=i.shift();i.unshift(["name",e]),i.unshift(["type",s]);var a={};return ui(i,a),function(t){"GEOGCS"===t.type?t.projName="longlat":"LOCAL_CS"===t.type?(t.projName="identity",t.local=!0):"object"==typeof t.PROJECTION?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),"metre"===t.units&&(t.units="meter"),t.UNIT.convert&&("GEOGCS"===t.type?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var i=t.GEOGCS;function s(i){return i*(t.to_meter||1)}"GEOGCS"===t.type&&(i=t),i&&(i.DATUM?t.datumCode=i.DATUM.name.toLowerCase():t.datumCode=i.name.toLowerCase(),"d_"===t.datumCode.slice(0,2)&&(t.datumCode=t.datumCode.slice(2)),"new_zealand_geodetic_datum_1949"!==t.datumCode&&"new_zealand_1949"!==t.datumCode||(t.datumCode="nzgd49"),"wgs_1984"===t.datumCode&&("Mercator_Auxiliary_Sphere"===t.PROJECTION&&(t.sphere=!0),t.datumCode="wgs84"),"_ferro"===t.datumCode.slice(-6)&&(t.datumCode=t.datumCode.slice(0,-6)),"_jakarta"===t.datumCode.slice(-8)&&(t.datumCode=t.datumCode.slice(0,-8)),~t.datumCode.indexOf("belge")&&(t.datumCode="rnb72"),i.DATUM&&i.DATUM.SPHEROID&&(t.ellps=i.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),"international"===t.ellps.toLowerCase().slice(0,13)&&(t.ellps="intl"),t.a=i.DATUM.SPHEROID.a,t.rf=parseFloat(i.DATUM.SPHEROID.rf,10)),i.DATUM&&i.DATUM.TOWGS84&&(t.datum_params=i.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),"ch1903+"===t.datumCode&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a),[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_2","Standard_Parallel_2"],["false_easting","False_Easting"],["false_northing","False_Northing"],["central_meridian","Central_Meridian"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",ci],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",ci],["x0","false_easting",s],["y0","false_northing",s],["long0","central_meridian",ci],["lat0","latitude_of_origin",ci],["lat0","standard_parallel_1",ci],["lat1","standard_parallel_1",ci],["lat2","standard_parallel_2",ci],["azimuth","Azimuth"],["alpha","azimuth",ci],["srsCode","name"]].forEach((function(i){return s=t,a=(e=i)[0],n=e[1],void(!(a in s)&&n in s&&(s[a]=s[n],3===e.length&&(s[a]=e[2](s[a]))));var s,e,a,n})),t.long0||!t.longc||"Albers_Conic_Equal_Area"!==t.projName&&"Lambert_Azimuthal_Equal_Area"!==t.projName||(t.long0=t.longc),t.lat_ts||!t.lat1||"Stereographic_South_Pole"!==t.projName&&"Polar Stereographic (variant B)"!==t.projName||(t.lat0=ci(t.lat1>0?90:-90),t.lat_ts=t.lat1)}(a),a}function di(t){var i=this;if(2===arguments.length){var s=arguments[1];"string"==typeof s?"+"===s.charAt(0)?di[t]=si(arguments[1]):di[t]=fi(arguments[1]):di[t]=s}else if(1===arguments.length){if(Array.isArray(t))return t.map((function(t){Array.isArray(t)?di.apply(i,t):di(t)}));if("string"==typeof t){if(t in di)return di[t]}else"EPSG"in t?di["EPSG:"+t.EPSG]=t:"ESRI"in t?di["ESRI:"+t.ESRI]=t:"IAU2000"in t?di["IAU2000:"+t.IAU2000]=t:console.log(t);return}}!function(t){t("EPSG:4326","+title=WGS 84 (long/lat) +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees"),t("EPSG:4269","+title=NAD83 (long/lat) +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees"),t("EPSG:3857","+title=WGS 84 / Pseudo-Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"),t.WGS84=t["EPSG:4326"],t["EPSG:3785"]=t["EPSG:3857"],t.GOOGLE=t["EPSG:3857"],t["EPSG:900913"]=t["EPSG:3857"],t["EPSG:102113"]=t["EPSG:3857"]}(di);var Mi=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];var pi=["3857","900913","3785","102113"];function mi(t){if(!function(t){return"string"==typeof t}(t))return t;if(function(t){return t in di}(t))return di[t];if(function(t){return Mi.some((function(i){return t.indexOf(i)>-1}))}(t)){var i=fi(t);if(function(t){var i=ii(t,"authority");if(i){var s=ii(i,"epsg");return s&&pi.indexOf(s)>-1}}(i))return di["EPSG:3857"];var s=function(t){var i=ii(t,"extension");if(i)return ii(i,"proj4")}(i);return s?si(s):i}return function(t){return"+"===t[0]}(t)?si(t):void 0}function gi(t,i){var s,e;if(t=t||{},!i)return t;for(e in i)void 0!==(s=i[e])&&(t[e]=s);return t}function yi(t,i,s){var e=t*i;return s/Math.sqrt(1-e*e)}function vi(t){return t<0?-1:1}function bi(t){return Math.abs(t)<=Kt?t:t-vi(t)*$t}function _i(t,i,s){var e=t*s,a=.5*t;return e=Math.pow((1-e)/(1+e),a),Math.tan(.5*(Qt-i))/e}function xi(t,i){for(var s,e,a=.5*t,n=Qt-2*Math.atan(i),r=0;r<=15;r++)if(s=t*Math.sin(n),n+=e=Qt-2*Math.atan(i*Math.pow((1-s)/(1+s),a))-n,Math.abs(e)<=1e-10)return n;return-9999}function wi(t){return t}var Ni=[{init:function(){var t=this.b/this.a;this.es=1-t*t,"x0"in this||(this.x0=0),"y0"in this||(this.y0=0),this.e=Math.sqrt(this.es),this.lat_ts?this.sphere?this.k0=Math.cos(this.lat_ts):this.k0=yi(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)):this.k0||(this.k?this.k0=this.k:this.k0=1)},forward:function(t){var i,s,e=t.x,a=t.y;if(a*Xt>90&&a*Xt<-90&&e*Xt>180&&e*Xt<-180)return null;if(Math.abs(Math.abs(a)-Qt)<=1e-10)return null;if(this.sphere)i=this.x0+this.a*this.k0*bi(e-this.long0),s=this.y0+this.a*this.k0*Math.log(Math.tan(Ht+.5*a));else{var n=Math.sin(a),r=_i(this.e,a,n);i=this.x0+this.a*this.k0*bi(e-this.long0),s=this.y0-this.a*this.k0*Math.log(r)}return t.x=i,t.y=s,t},inverse:function(t){var i,s,e=t.x-this.x0,a=t.y-this.y0;if(this.sphere)s=Qt-2*Math.atan(Math.exp(-a/(this.a*this.k0)));else{var n=Math.exp(-a/(this.a*this.k0));if(-9999===(s=xi(this.e,n)))return null}return i=bi(this.long0+e/(this.a*this.k0)),t.x=i,t.y=s,t},names:["Mercator","Popular Visualisation Pseudo Mercator","Mercator_1SP","Mercator_Auxiliary_Sphere","merc"]},{init:function(){},forward:wi,inverse:wi,names:["longlat","identity"]}],Ci={},Pi=[];function Si(t,i){var s=Pi.length;return t.names?(Pi[s]=t,t.names.forEach((function(t){Ci[t.toLowerCase()]=s})),this):(console.log(i),!0)}var Ai={start:function(){Ni.forEach(Si)},add:Si,get:function(t){if(!t)return!1;var i=t.toLowerCase();return void 0!==Ci[i]&&Pi[Ci[i]]?Pi[Ci[i]]:void 0}},Ei={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},APL4:{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},clrk58:{a:6378293.645208759,rf:294.2606763692654,ellipseName:"Clarke 1858"},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS7:{a:6378135,rf:298.26,ellipseName:"WGS 72"}},Oi=Ei.WGS84={a:6378137,rf:298.257223563,ellipseName:"WGS 84"};Ei.sphere={a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"};var ki={};function Ii(t,i){if(!(this instanceof Ii))return new Ii(t);i=i||function(t){if(t)throw t};var s=mi(t);if("object"==typeof s){var e=Ii.projections.get(s.projName);if(e){if(s.datumCode&&"none"!==s.datumCode){var a=ii(ki,s.datumCode);a&&(s.datum_params=a.towgs84?a.towgs84.split(","):null,s.ellps=a.ellipse,s.datumName=a.datumName?a.datumName:s.datumCode)}s.k0=s.k0||1,s.axis=s.axis||"enu",s.ellps=s.ellps||"wgs84";var n,r,h,o,l,u,c,f=function(t,i,s,e,a){if(!t){var n=ii(Ei,e);n||(n=Oi),t=n.a,i=n.b,s=n.rf}return s&&!i&&(i=(1-1/s)*t),(0===s||Math.abs(t-i)<1e-10)&&(a=!0,i=t),{a:t,b:i,rf:s,sphere:a}}(s.a,s.b,s.rf,s.ellps,s.sphere),d=(n=f.a,r=f.b,f.rf,h=s.R_A,u=((o=n*n)-(l=r*r))/o,c=0,h?(o=(n*=1-u*(.16666666666666666+u*(.04722222222222222+.022156084656084655*u)))*n,u=0):c=Math.sqrt(u),{es:u,e:c,ep2:(o-l)/l}),M=s.datum||function(t,i,s,e,a,n){var r={};return r.datum_type=void 0===t||"none"===t?5:4,i&&(r.datum_params=i.map(parseFloat),0===r.datum_params[0]&&0===r.datum_params[1]&&0===r.datum_params[2]||(r.datum_type=1),r.datum_params.length>3&&(0===r.datum_params[3]&&0===r.datum_params[4]&&0===r.datum_params[5]&&0===r.datum_params[6]||(r.datum_type=2,r.datum_params[3]*=Jt,r.datum_params[4]*=Jt,r.datum_params[5]*=Jt,r.datum_params[6]=r.datum_params[6]/1e6+1))),r.a=s,r.b=e,r.es=a,r.ep2=n,r}(s.datumCode,s.datum_params,f.a,f.b,d.es,d.ep2);gi(this,s),gi(this,e),this.a=f.a,this.b=f.b,this.rf=f.rf,this.sphere=f.sphere,this.es=d.es,this.e=d.e,this.ep2=d.ep2,this.datum=M,this.init(),i(null,this)}else i(t)}else i(t)}function Ti(t,i,s){var e,a,n,r,h=t.x,o=t.y,l=t.z?t.z:0;if(o<-Qt&&o>-1.001*Qt)o=-Qt;else if(o>Qt&&o<1.001*Qt)o=Qt;else{if(o<-Qt)return{x:-1/0,y:-1/0,z:t.z};if(o>Qt)return{x:1/0,y:1/0,z:t.z}}return h>Math.PI&&(h-=2*Math.PI),a=Math.sin(o),r=Math.cos(o),n=a*a,{x:((e=s/Math.sqrt(1-i*n))+l)*r*Math.cos(h),y:(e+l)*r*Math.sin(h),z:(e*(1-i)+l)*a}}function ji(t,i,s,e){var a,n,r,h,o,l,u,c,f,d,M,p,m,g,y,v=t.x,b=t.y,_=t.z?t.z:0;if(a=Math.sqrt(v*v+b*b),n=Math.sqrt(v*v+b*b+_*_),a/s<1e-12){if(g=0,n/s<1e-12)return Qt,y=-e,{x:t.x,y:t.y,z:t.z}}else g=Math.atan2(b,v);r=_/n,c=(h=a/n)*(1-i)*(o=1/Math.sqrt(1-i*(2-i)*h*h)),f=r*o,m=0;do{m++,l=i*(u=s/Math.sqrt(1-i*f*f))/(u+(y=a*c+_*f-u*(1-i*f*f))),p=(M=r*(o=1/Math.sqrt(1-l*(2-l)*h*h)))*c-(d=h*(1-l)*o)*f,c=d,f=M}while(p*p>1e-24&&m<30);return{x:g,y:Math.atan(M/Math.abs(d)),z:y}}function qi(t){return 1===t||2===t}function Ri(t,i,s){return function(t,i){return t.datum_type===i.datum_type&&(!(t.a!==i.a||Math.abs(t.es-i.es)>5e-11)&&(1===t.datum_type?t.datum_params[0]===i.datum_params[0]&&t.datum_params[1]===i.datum_params[1]&&t.datum_params[2]===i.datum_params[2]:2!==t.datum_type||t.datum_params[0]===i.datum_params[0]&&t.datum_params[1]===i.datum_params[1]&&t.datum_params[2]===i.datum_params[2]&&t.datum_params[3]===i.datum_params[3]&&t.datum_params[4]===i.datum_params[4]&&t.datum_params[5]===i.datum_params[5]&&t.datum_params[6]===i.datum_params[6]))}(t,i)?s:5===t.datum_type||5===i.datum_type?s:t.es!==i.es||t.a!==i.a||qi(t.datum_type)||qi(i.datum_type)?(s=Ti(s,t.es,t.a),qi(t.datum_type)&&(s=function(t,i,s){if(1===i)return{x:t.x+s[0],y:t.y+s[1],z:t.z+s[2]};if(2===i){var e=s[0],a=s[1],n=s[2],r=s[3],h=s[4],o=s[5],l=s[6];return{x:l*(t.x-o*t.y+h*t.z)+e,y:l*(o*t.x+t.y-r*t.z)+a,z:l*(-h*t.x+r*t.y+t.z)+n}}}(s,t.datum_type,t.datum_params)),qi(i.datum_type)&&(s=function(t,i,s){if(1===i)return{x:t.x-s[0],y:t.y-s[1],z:t.z-s[2]};if(2===i){var e=s[0],a=s[1],n=s[2],r=s[3],h=s[4],o=s[5],l=s[6],u=(t.x-e)/l,c=(t.y-a)/l,f=(t.z-n)/l;return{x:u+o*c-h*f,y:-o*u+c+r*f,z:h*u-r*c+f}}}(s,i.datum_type,i.datum_params)),ji(s,i.es,i.a,i.b)):s}function Fi(t,i,s){var e,a,n,r=s.x,h=s.y,o=s.z||0,l={};for(n=0;n<3;n++)if(!i||2!==n||void 0!==s.z)switch(0===n?(e=r,a="x"):1===n?(e=h,a="y"):(e=o,a="z"),t.axis[n]){case"e":l[a]=e;break;case"w":l[a]=-e;break;case"n":l[a]=e;break;case"s":l[a]=-e;break;case"u":void 0!==s[a]&&(l.z=e);break;case"d":void 0!==s[a]&&(l.z=-e);break;default:return null}return l}function Di(t){var i={x:t[0],y:t[1]};return t.length>2&&(i.z=t[2]),t.length>3&&(i.m=t[3]),i}function Li(t){if("function"==typeof Number.isFinite){if(Number.isFinite(t))return;throw new TypeError("coordinates must be finite numbers")}if("number"!=typeof t||t!=t||!isFinite(t))throw new TypeError("coordinates must be finite numbers")}function Gi(t,i,s){var e;return Array.isArray(s)&&(s=Di(s)),function(t){Li(t.x),Li(t.y)}(s),t.datum&&i.datum&&function(t,i){return(1===t.datum.datum_type||2===t.datum.datum_type)&&"WGS84"!==i.datumCode||(1===i.datum.datum_type||2===i.datum.datum_type)&&"WGS84"!==t.datumCode}(t,i)&&(s=Gi(t,e=new Ii("WGS84"),s),t=e),"enu"!==t.axis&&(s=Fi(t,!1,s)),"longlat"===t.projName?s={x:s.x*Wt,y:s.y*Wt,z:s.z||0}:(t.to_meter&&(s={x:s.x*t.to_meter,y:s.y*t.to_meter,z:s.z||0}),s=t.inverse(s)),t.from_greenwich&&(s.x+=t.from_greenwich),s=Ri(t.datum,i.datum,s),i.from_greenwich&&(s={x:s.x-i.from_greenwich,y:s.y,z:s.z||0}),"longlat"===i.projName?s={x:s.x*Xt,y:s.y*Xt,z:s.z||0}:(s=i.forward(s),i.to_meter&&(s={x:s.x/i.to_meter,y:s.y/i.to_meter,z:s.z||0})),"enu"!==i.axis?Fi(i,!0,s):s}ki.wgs84={towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},ki.ch1903={towgs84:"674.374,15.056,405.346",ellipse:"bessel",datumName:"swiss"},ki.ggrs87={towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},ki.nad83={towgs84:"0,0,0",ellipse:"GRS80",datumName:"North_American_Datum_1983"},ki.nad27={nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},ki.potsdam={towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},ki.carthage={towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},ki.hermannskogel={towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ki.osni52={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"airy",datumName:"Irish National"},ki.ire65={towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},ki.rassadiran={towgs84:"-133.63,-157.5,-158.62",ellipse:"intl",datumName:"Rassadiran"},ki.nzgd49={towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},ki.osgb36={towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"},ki.s_jtsk={towgs84:"589,76,480",ellipse:"bessel",datumName:"S-JTSK (Ferro)"},ki.beduaram={towgs84:"-106,-87,188",ellipse:"clrk80",datumName:"Beduaram"},ki.gunung_segara={towgs84:"-403,684,41",ellipse:"bessel",datumName:"Gunung Segara Jakarta"},ki.rnb72={towgs84:"106.869,-52.2978,103.724,-0.33657,0.456955,-1.84218,1",ellipse:"intl",datumName:"Reseau National Belge 1972"},Ii.projections=Ai,Ii.projections.start();var zi=Ii("WGS84");function Bi(t,i,s){var e,a,n;return Array.isArray(s)?(e=Gi(t,i,s)||{x:NaN,y:NaN},s.length>2?void 0!==t.name&&"geocent"===t.name||void 0!==i.name&&"geocent"===i.name?"number"==typeof e.z?[e.x,e.y,e.z].concat(s.splice(3)):[e.x,e.y,s[2]].concat(s.splice(3)):[e.x,e.y].concat(s.splice(2)):[e.x,e.y]):(a=Gi(t,i,s),2===(n=Object.keys(s)).length?a:(n.forEach((function(e){if(void 0!==t.name&&"geocent"===t.name||void 0!==i.name&&"geocent"===i.name){if("x"===e||"y"===e||"z"===e)return}else if("x"===e||"y"===e)return;a[e]=s[e]})),a))}function Ui(t){return t instanceof Ii?t:t.oProj?t.oProj:Ii(t)}function Vi(t,i,s){t=Ui(t);var e,a=!1;return void 0===i?(i=t,t=zi,a=!0):(void 0!==i.x||Array.isArray(i))&&(s=i,i=t,t=zi,a=!0),i=Ui(i),s?Bi(t,i,s):(e={forward:function(s){return Bi(t,i,s)},inverse:function(s){return Bi(i,t,s)}},a&&(e.oProj=i),e)}var Ji=65,Qi=73,Wi=79,Xi={forward:Hi,inverse:function(t){var i=Yi(ss(t.toUpperCase()));if(i.lat&&i.lon)return[i.lon,i.lat,i.lon,i.lat];return[i.left,i.bottom,i.right,i.top]},toPoint:$i};function Hi(t,i){return i=i||5,function(t,i){var s="00000"+t.easting,e="00000"+t.northing;return t.zoneNumber+t.zoneLetter+(d=t.easting,M=t.northing,p=t.zoneNumber,m=is(p),g=Math.floor(d/1e5),y=Math.floor(M/1e5)%20,a=g,n=y,r=m,h=r-1,o="AJSAJS".charCodeAt(h),l="AFAFAF".charCodeAt(h),u=o+a-1,c=l+n,f=!1,u>90&&(u=u-90+Ji-1,f=!0),(u===Qi||o<Qi&&u>Qi||(u>Qi||o<Qi)&&f)&&u++,(u===Wi||o<Wi&&u>Wi||(u>Wi||o<Wi)&&f)&&++u===Qi&&u++,u>90&&(u=u-90+Ji-1),c>86?(c=c-86+Ji-1,f=!0):f=!1,(c===Qi||l<Qi&&c>Qi||(c>Qi||l<Qi)&&f)&&c++,(c===Wi||l<Wi&&c>Wi||(c>Wi||l<Wi)&&f)&&++c===Qi&&c++,c>86&&(c=c-86+Ji-1),String.fromCharCode(u)+String.fromCharCode(c))+s.substr(s.length-5,i)+e.substr(e.length-5,i);var a,n,r,h,o,l,u,c,f;var d,M,p,m,g,y}(function(t){var i,s,e,a,n,r,h,o=t.lat,l=t.lon,u=6378137,c=Ki(o),f=Ki(l);h=Math.floor((l+180)/6)+1,180===l&&(h=60);o>=56&&o<64&&l>=3&&l<12&&(h=32);o>=72&&o<84&&(l>=0&&l<9?h=31:l>=9&&l<21?h=33:l>=21&&l<33?h=35:l>=33&&l<42&&(h=37));r=Ki(6*(h-1)-180+3),.006739496752268451,i=u/Math.sqrt(1-.00669438*Math.sin(c)*Math.sin(c)),s=Math.tan(c)*Math.tan(c),e=.006739496752268451*Math.cos(c)*Math.cos(c),a=Math.cos(c)*(f-r),n=u*(.9983242984503243*c-.002514607064228144*Math.sin(2*c)+2639046602129982e-21*Math.sin(4*c)-3.418046101696858e-9*Math.sin(6*c));var d=.9996*i*(a+(1-s+e)*a*a*a/6+(5-18*s+s*s+72*e-.39089081163157013)*a*a*a*a*a/120)+5e5,M=.9996*(n+i*Math.tan(c)*(a*a/2+(5-s+9*e+4*e*e)*a*a*a*a/24+(61-58*s+s*s+600*e-2.2240339282485886)*a*a*a*a*a*a/720));o<0&&(M+=1e7);return{northing:Math.round(M),easting:Math.round(d),zoneNumber:h,zoneLetter:ts(o)}}({lat:t[1],lon:t[0]}),i)}function $i(t){var i=Yi(ss(t.toUpperCase()));return i.lat&&i.lon?[i.lon,i.lat]:[(i.left+i.right)/2,(i.top+i.bottom)/2]}function Ki(t){return t*(Math.PI/180)}function Zi(t){return t/Math.PI*180}function Yi(t){var i=t.northing,s=t.easting,e=t.zoneLetter,a=t.zoneNumber;if(a<0||a>60)return null;var n,r,h,o,l,u,c,f,d=6378137,M=(1-Math.sqrt(.99330562))/(1+Math.sqrt(.99330562)),p=s-5e5,m=i;e<"N"&&(m-=1e7),u=6*(a-1)-180+3,f=(c=m/.9996/6367449.145945056)+(3*M/2-27*M*M*M/32)*Math.sin(2*c)+(21*M*M/16-55*M*M*M*M/32)*Math.sin(4*c)+151*M*M*M/96*Math.sin(6*c),n=d/Math.sqrt(1-.00669438*Math.sin(f)*Math.sin(f)),r=Math.tan(f)*Math.tan(f),h=.006739496752268451*Math.cos(f)*Math.cos(f),o=.99330562*d/Math.pow(1-.00669438*Math.sin(f)*Math.sin(f),1.5),l=p/(.9996*n);var g=f-n*Math.tan(f)/o*(l*l/2-(5+3*r+10*h-4*h*h-.06065547077041606)*l*l*l*l/24+(61+90*r+298*h+45*r*r-1.6983531815716497-3*h*h)*l*l*l*l*l*l/720);g=Zi(g);var y,v=(l-(1+2*r+h)*l*l*l/6+(5-2*h+28*r-3*h*h+.05391597401814761+24*r*r)*l*l*l*l*l/120)/Math.cos(f);if(v=u+Zi(v),t.accuracy){var b=Yi({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});y={top:b.lat,right:b.lon,bottom:g,left:v}}else y={lat:g,lon:v};return y}function ts(t){var i="Z";return 84>=t&&t>=72?i="X":72>t&&t>=64?i="W":64>t&&t>=56?i="V":56>t&&t>=48?i="U":48>t&&t>=40?i="T":40>t&&t>=32?i="S":32>t&&t>=24?i="R":24>t&&t>=16?i="Q":16>t&&t>=8?i="P":8>t&&t>=0?i="N":0>t&&t>=-8?i="M":-8>t&&t>=-16?i="L":-16>t&&t>=-24?i="K":-24>t&&t>=-32?i="J":-32>t&&t>=-40?i="H":-40>t&&t>=-48?i="G":-48>t&&t>=-56?i="F":-56>t&&t>=-64?i="E":-64>t&&t>=-72?i="D":-72>t&&t>=-80&&(i="C"),i}function is(t){var i=t%6;return 0===i&&(i=6),i}function ss(t){if(t&&0===t.length)throw"MGRSPoint coverting from nothing";for(var i,s=t.length,e=null,a="",n=0;!/[A-Z]/.test(i=t.charAt(n));){if(n>=2)throw"MGRSPoint bad conversion from: "+t;a+=i,n++}var r=parseInt(a,10);if(0===n||n+3>s)throw"MGRSPoint bad conversion from: "+t;var h=t.charAt(n++);if(h<="A"||"B"===h||"Y"===h||h>="Z"||"I"===h||"O"===h)throw"MGRSPoint zone letter "+h+" not handled: "+t;e=t.substring(n,n+=2);for(var o=is(r),l=function(t,i){var s="AJSAJS".charCodeAt(i-1),e=1e5,a=!1;for(;s!==t.charCodeAt(0);){if(++s===Qi&&s++,s===Wi&&s++,s>90){if(a)throw"Bad character: "+t;s=Ji,a=!0}e+=1e5}return e}(e.charAt(0),o),u=function(t,i){if(t>"V")throw"MGRSPoint given invalid Northing "+t;var s="AFAFAF".charCodeAt(i-1),e=0,a=!1;for(;s!==t.charCodeAt(0);){if(++s===Qi&&s++,s===Wi&&s++,s>86){if(a)throw"Bad character: "+t;s=Ji,a=!0}e+=1e5}return e}(e.charAt(1),o);u<es(h);)u+=2e6;var c=s-n;if(c%2!=0)throw"MGRSPoint has to have an even number \nof digits after the zone letter and two 100km letters - front \nhalf for easting meters, second half for \nnorthing meters"+t;var f,d,M,p=c/2,m=0,g=0;return p>0&&(f=1e5/Math.pow(10,p),d=t.substring(n,n+p),m=parseFloat(d)*f,M=t.substring(n+p),g=parseFloat(M)*f),{easting:m+l,northing:g+u,zoneLetter:h,zoneNumber:r,accuracy:f}}function es(t){var i;switch(t){case"C":i=11e5;break;case"D":i=2e6;break;case"E":i=28e5;break;case"F":i=37e5;break;case"G":i=46e5;break;case"H":i=55e5;break;case"J":i=64e5;break;case"K":i=73e5;break;case"L":i=82e5;break;case"M":i=91e5;break;case"N":i=0;break;case"P":i=8e5;break;case"Q":i=17e5;break;case"R":i=26e5;break;case"S":i=35e5;break;case"T":i=44e5;break;case"U":i=53e5;break;case"V":i=62e5;break;case"W":i=7e6;break;case"X":i=79e5;break;default:i=-1}if(i>=0)return i;throw"Invalid zone letter: "+t}function as(t,i,s){if(!(this instanceof as))return new as(t,i,s);if(Array.isArray(t))this.x=t[0],this.y=t[1],this.z=t[2]||0;else if("object"==typeof t)this.x=t.x,this.y=t.y,this.z=t.z||0;else if("string"==typeof t&&void 0===i){var e=t.split(",");this.x=parseFloat(e[0],10),this.y=parseFloat(e[1],10),this.z=parseFloat(e[2],10)||0}else this.x=t,this.y=i,this.z=s||0;console.warn("proj4.Point will be removed in version 3, use proj4.toPoint")}as.fromMGRS=function(t){return new as($i(t))},as.prototype.toMGRS=function(t){return Hi([this.x,this.y],t)};var ns=.01068115234375;function rs(t){var i=[];i[0]=1-t*(.25+t*(.046875+t*(.01953125+t*ns))),i[1]=t*(.75-t*(.046875+t*(.01953125+t*ns)));var s=t*t;return i[2]=s*(.46875-t*(.013020833333333334+.007120768229166667*t)),s*=t,i[3]=s*(.3645833333333333-.005696614583333333*t),i[4]=s*t*.3076171875,i}function hs(t,i,s,e){return s*=i,i*=i,e[0]*t-s*(e[1]+i*(e[2]+i*(e[3]+i*e[4])))}function os(t,i,s){for(var e=1/(1-i),a=t,n=20;n;--n){var r=Math.sin(a),h=1-i*r*r;if(a-=h=(hs(a,r,Math.cos(a),s)-t)*(h*Math.sqrt(h))*e,Math.abs(h)<1e-10)return a}return a}var ls={init:function(){this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.es&&(this.en=rs(this.es),this.ml0=hs(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en))},forward:function(t){var i,s,e,a=t.x,n=t.y,r=bi(a-this.long0),h=Math.sin(n),o=Math.cos(n);if(this.es){var l=o*r,u=Math.pow(l,2),c=this.ep2*Math.pow(o,2),f=Math.pow(c,2),d=Math.abs(o)>1e-10?Math.tan(n):0,M=Math.pow(d,2),p=Math.pow(M,2);i=1-this.es*Math.pow(h,2),l/=Math.sqrt(i);var m=hs(n,h,o,this.en);s=this.a*(this.k0*l*(1+u/6*(1-M+c+u/20*(5-18*M+p+14*c-58*M*c+u/42*(61+179*p-p*M-479*M)))))+this.x0,e=this.a*(this.k0*(m-this.ml0+h*r*l/2*(1+u/12*(5-M+9*c+4*f+u/30*(61+p-58*M+270*c-330*M*c+u/56*(1385+543*p-p*M-3111*M))))))+this.y0}else{var g=o*Math.sin(r);if(Math.abs(Math.abs(g)-1)<1e-10)return 93;if(s=.5*this.a*this.k0*Math.log((1+g)/(1-g))+this.x0,e=o*Math.cos(r)/Math.sqrt(1-Math.pow(g,2)),(g=Math.abs(e))>=1){if(g-1>1e-10)return 93;e=0}else e=Math.acos(e);n<0&&(e=-e),e=this.a*this.k0*(e-this.lat0)+this.y0}return t.x=s,t.y=e,t},inverse:function(t){var i,s,e,a,n=(t.x-this.x0)*(1/this.a),r=(t.y-this.y0)*(1/this.a);if(this.es)if(s=os(i=this.ml0+r/this.k0,this.es,this.en),Math.abs(s)<Qt){var h=Math.sin(s),o=Math.cos(s),l=Math.abs(o)>1e-10?Math.tan(s):0,u=this.ep2*Math.pow(o,2),c=Math.pow(u,2),f=Math.pow(l,2),d=Math.pow(f,2);i=1-this.es*Math.pow(h,2);var M=n*Math.sqrt(i)/this.k0,p=Math.pow(M,2);e=s-(i*=l)*p/(1-this.es)*.5*(1-p/12*(5+3*f-9*u*f+u-4*c-p/30*(61+90*f-252*u*f+45*d+46*u-p/56*(1385+3633*f+4095*d+1574*d*f)))),a=bi(this.long0+M*(1-p/6*(1+2*f+u-p/20*(5+28*f+24*d+8*u*f+6*u-p/42*(61+662*f+1320*d+720*d*f))))/o)}else e=Qt*vi(r),a=0;else{var m=Math.exp(n/this.k0),g=.5*(m-1/m),y=this.lat0+r/this.k0,v=Math.cos(y);i=Math.sqrt((1-Math.pow(v,2))/(1+Math.pow(g,2))),e=Math.asin(i),r<0&&(e=-e),a=0===g&&0===v?0:bi(Math.atan2(g,v)+this.long0)}return t.x=a,t.y=e,t},names:["Transverse_Mercator","Transverse Mercator","tmerc"]};function us(t){var i=Math.exp(t);return i=(i-1/i)/2}function cs(t,i){t=Math.abs(t),i=Math.abs(i);var s=Math.max(t,i),e=Math.min(t,i)/(s||1);return s*Math.sqrt(1+Math.pow(e,2))}function fs(t){var i=Math.abs(t);return i=function(t){var i=1+t,s=i-1;return 0===s?t:t*Math.log(i)/s}(i*(1+i/(cs(1,i)+1))),t<0?-i:i}function ds(t,i){for(var s,e=2*Math.cos(2*i),a=t.length-1,n=t[a],r=0;--a>=0;)s=e*n-r+t[a],r=n,n=s;return i+s*Math.sin(2*i)}function Ms(t,i,s){for(var e,a,n=Math.sin(i),r=Math.cos(i),h=us(s),o=function(t){var i=Math.exp(t);return i=(i+1/i)/2}(s),l=2*r*o,u=-2*n*h,c=t.length-1,f=t[c],d=0,M=0,p=0;--c>=0;)e=M,a=d,f=l*(M=f)-e-u*(d=p)+t[c],p=u*M-a+l*d;return[(l=n*o)*f-(u=r*h)*p,l*p+u*f]}var ps={init:function(){if(void 0===this.es||this.es<=0)throw new Error("incorrect elliptical usage");this.x0=void 0!==this.x0?this.x0:0,this.y0=void 0!==this.y0?this.y0:0,this.long0=void 0!==this.long0?this.long0:0,this.lat0=void 0!==this.lat0?this.lat0:0,this.cgb=[],this.cbg=[],this.utg=[],this.gtu=[];var t=this.es/(1+Math.sqrt(1-this.es)),i=t/(2-t),s=i;this.cgb[0]=i*(2+i*(-2/3+i*(i*(116/45+i*(26/45+i*(-2854/675)))-2))),this.cbg[0]=i*(i*(2/3+i*(4/3+i*(-82/45+i*(32/45+i*(4642/4725)))))-2),s*=i,this.cgb[1]=s*(7/3+i*(i*(-227/45+i*(2704/315+i*(2323/945)))-1.6)),this.cbg[1]=s*(5/3+i*(-16/15+i*(-13/9+i*(904/315+i*(-1522/945))))),s*=i,this.cgb[2]=s*(56/15+i*(-136/35+i*(-1262/105+i*(73814/2835)))),this.cbg[2]=s*(-26/15+i*(34/21+i*(1.6+i*(-12686/2835)))),s*=i,this.cgb[3]=s*(4279/630+i*(-332/35+i*(-399572/14175))),this.cbg[3]=s*(1237/630+i*(i*(-24832/14175)-2.4)),s*=i,this.cgb[4]=s*(4174/315+i*(-144838/6237)),this.cbg[4]=s*(-734/315+i*(109598/31185)),s*=i,this.cgb[5]=s*(601676/22275),this.cbg[5]=s*(444337/155925),s=Math.pow(i,2),this.Qn=this.k0/(1+i)*(1+s*(.25+s*(1/64+s/256))),this.utg[0]=i*(i*(2/3+i*(-37/96+i*(1/360+i*(81/512+i*(-96199/604800)))))-.5),this.gtu[0]=i*(.5+i*(-2/3+i*(5/16+i*(41/180+i*(-127/288+i*(7891/37800)))))),this.utg[1]=s*(-1/48+i*(-1/15+i*(437/1440+i*(-46/105+i*(1118711/3870720))))),this.gtu[1]=s*(13/48+i*(i*(557/1440+i*(281/630+i*(-1983433/1935360)))-.6)),s*=i,this.utg[2]=s*(-17/480+i*(37/840+i*(209/4480+i*(-5569/90720)))),this.gtu[2]=s*(61/240+i*(-103/140+i*(15061/26880+i*(167603/181440)))),s*=i,this.utg[3]=s*(-4397/161280+i*(11/504+i*(830251/7257600))),this.gtu[3]=s*(49561/161280+i*(-179/168+i*(6601661/7257600))),s*=i,this.utg[4]=s*(-4583/161280+i*(108847/3991680)),this.gtu[4]=s*(34729/80640+i*(-3418889/1995840)),s*=i,this.utg[5]=-.03233083094085698*s,this.gtu[5]=.6650675310896665*s;var e=ds(this.cbg,this.lat0);this.Zb=-this.Qn*(e+function(t,i){for(var s,e=2*Math.cos(i),a=t.length-1,n=t[a],r=0;--a>=0;)s=e*n-r+t[a],r=n,n=s;return Math.sin(i)*s}(this.gtu,2*e))},forward:function(t){var i=bi(t.x-this.long0),s=t.y;s=ds(this.cbg,s);var e=Math.sin(s),a=Math.cos(s),n=Math.sin(i),r=Math.cos(i);s=Math.atan2(e,r*a),i=Math.atan2(n*a,cs(e,a*r)),i=fs(Math.tan(i));var h,o,l=Ms(this.gtu,2*s,2*i);return s+=l[0],i+=l[1],Math.abs(i)<=2.623395162778?(h=this.a*(this.Qn*i)+this.x0,o=this.a*(this.Qn*s+this.Zb)+this.y0):(h=1/0,o=1/0),t.x=h,t.y=o,t},inverse:function(t){var i,s,e=(t.x-this.x0)*(1/this.a),a=(t.y-this.y0)*(1/this.a);if(a=(a-this.Zb)/this.Qn,e/=this.Qn,Math.abs(e)<=2.623395162778){var n=Ms(this.utg,2*a,2*e);a+=n[0],e+=n[1],e=Math.atan(us(e));var r=Math.sin(a),h=Math.cos(a),o=Math.sin(e),l=Math.cos(e);a=Math.atan2(r*l,cs(o,l*h)),i=bi((e=Math.atan2(o,l*h))+this.long0),s=ds(this.cgb,a)}else i=1/0,s=1/0;return t.x=i,t.y=s,t},names:["Extended_Transverse_Mercator","Extended Transverse Mercator","etmerc"]};var ms={init:function(){var t=function(t,i){if(void 0===t){if((t=Math.floor(30*(bi(i)+Math.PI)/Math.PI)+1)<0)return 0;if(t>60)return 60}return t}(this.zone,this.long0);if(void 0===t)throw new Error("unknown utm zone");this.lat0=0,this.long0=(6*Math.abs(t)-183)*Wt,this.x0=5e5,this.y0=this.utmSouth?1e7:0,this.k0=.9996,ps.init.apply(this),this.forward=ps.forward,this.inverse=ps.inverse},names:["Universal Transverse Mercator System","utm"],dependsOn:"etmerc"};function gs(t,i){return Math.pow((1-t)/(1+t),i)}var ys={init:function(){var t=Math.sin(this.lat0),i=Math.cos(this.lat0);i*=i,this.rc=Math.sqrt(1-this.es)/(1-this.es*t*t),this.C=Math.sqrt(1+this.es*i*i/(1-this.es)),this.phic0=Math.asin(t/this.C),this.ratexp=.5*this.C*this.e,this.K=Math.tan(.5*this.phic0+Ht)/(Math.pow(Math.tan(.5*this.lat0+Ht),this.C)*gs(this.e*t,this.ratexp))},forward:function(t){var i=t.x,s=t.y;return t.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*s+Ht),this.C)*gs(this.e*Math.sin(s),this.ratexp))-Qt,t.x=this.C*i,t},inverse:function(t){for(var i=t.x/this.C,s=t.y,e=Math.pow(Math.tan(.5*s+Ht)/this.K,1/this.C),a=20;a>0&&(s=2*Math.atan(e*gs(this.e*Math.sin(t.y),-.5*this.e))-Qt,!(Math.abs(s-t.y)<1e-14));--a)t.y=s;return a?(t.x=i,t.y=s,t):null},names:["gauss"]};var vs={init:function(){ys.init.apply(this),this.rc&&(this.sinc0=Math.sin(this.phic0),this.cosc0=Math.cos(this.phic0),this.R2=2*this.rc,this.title||(this.title="Oblique Stereographic Alternative"))},forward:function(t){var i,s,e,a;return t.x=bi(t.x-this.long0),ys.forward.apply(this,[t]),i=Math.sin(t.y),s=Math.cos(t.y),e=Math.cos(t.x),a=this.k0*this.R2/(1+this.sinc0*i+this.cosc0*s*e),t.x=a*s*Math.sin(t.x),t.y=a*(this.cosc0*i-this.sinc0*s*e),t.x=this.a*t.x+this.x0,t.y=this.a*t.y+this.y0,t},inverse:function(t){var i,s,e,a,n;if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,n=Math.sqrt(t.x*t.x+t.y*t.y)){var r=2*Math.atan2(n,this.R2);i=Math.sin(r),s=Math.cos(r),a=Math.asin(s*this.sinc0+t.y*i*this.cosc0/n),e=Math.atan2(t.x*i,n*this.cosc0*s-t.y*this.sinc0*i)}else a=this.phic0,e=0;return t.x=e,t.y=a,ys.inverse.apply(this,[t]),t.x=bi(t.x+this.long0),t},names:["Stereographic_North_Pole","Oblique_Stereographic","Polar_Stereographic","sterea","Oblique Stereographic Alternative","Double_Stereographic"]};var bs={init:function(){this.coslat0=Math.cos(this.lat0),this.sinlat0=Math.sin(this.lat0),this.sphere?1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*(1+vi(this.lat0)*Math.sin(this.lat_ts))):(Math.abs(this.coslat0)<=1e-10&&(this.lat0>0?this.con=1:this.con=-1),this.cons=Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)),1===this.k0&&!isNaN(this.lat_ts)&&Math.abs(this.coslat0)<=1e-10&&(this.k0=.5*this.cons*yi(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts))/_i(this.e,this.con*this.lat_ts,this.con*Math.sin(this.lat_ts))),this.ms1=yi(this.e,this.sinlat0,this.coslat0),this.X0=2*Math.atan(this.ssfn_(this.lat0,this.sinlat0,this.e))-Qt,this.cosX0=Math.cos(this.X0),this.sinX0=Math.sin(this.X0))},forward:function(t){var i,s,e,a,n,r,h=t.x,o=t.y,l=Math.sin(o),u=Math.cos(o),c=bi(h-this.long0);return Math.abs(Math.abs(h-this.long0)-Math.PI)<=1e-10&&Math.abs(o+this.lat0)<=1e-10?(t.x=NaN,t.y=NaN,t):this.sphere?(i=2*this.k0/(1+this.sinlat0*l+this.coslat0*u*Math.cos(c)),t.x=this.a*i*u*Math.sin(c)+this.x0,t.y=this.a*i*(this.coslat0*l-this.sinlat0*u*Math.cos(c))+this.y0,t):(s=2*Math.atan(this.ssfn_(o,l,this.e))-Qt,a=Math.cos(s),e=Math.sin(s),Math.abs(this.coslat0)<=1e-10?(n=_i(this.e,o*this.con,this.con*l),r=2*this.a*this.k0*n/this.cons,t.x=this.x0+r*Math.sin(h-this.long0),t.y=this.y0-this.con*r*Math.cos(h-this.long0),t):(Math.abs(this.sinlat0)<1e-10?(i=2*this.a*this.k0/(1+a*Math.cos(c)),t.y=i*e):(i=2*this.a*this.k0*this.ms1/(this.cosX0*(1+this.sinX0*e+this.cosX0*a*Math.cos(c))),t.y=i*(this.cosX0*e-this.sinX0*a*Math.cos(c))+this.y0),t.x=i*a*Math.sin(c)+this.x0,t))},inverse:function(t){var i,s,e,a,n;t.x-=this.x0,t.y-=this.y0;var r=Math.sqrt(t.x*t.x+t.y*t.y);if(this.sphere){var h=2*Math.atan(r/(2*this.a*this.k0));return i=this.long0,s=this.lat0,r<=1e-10?(t.x=i,t.y=s,t):(s=Math.asin(Math.cos(h)*this.sinlat0+t.y*Math.sin(h)*this.coslat0/r),i=Math.abs(this.coslat0)<1e-10?this.lat0>0?bi(this.long0+Math.atan2(t.x,-1*t.y)):bi(this.long0+Math.atan2(t.x,t.y)):bi(this.long0+Math.atan2(t.x*Math.sin(h),r*this.coslat0*Math.cos(h)-t.y*this.sinlat0*Math.sin(h))),t.x=i,t.y=s,t)}if(Math.abs(this.coslat0)<=1e-10){if(r<=1e-10)return s=this.lat0,i=this.long0,t.x=i,t.y=s,t;t.x*=this.con,t.y*=this.con,e=r*this.cons/(2*this.a*this.k0),s=this.con*xi(this.e,e),i=this.con*bi(this.con*this.long0+Math.atan2(t.x,-1*t.y))}else a=2*Math.atan(r*this.cosX0/(2*this.a*this.k0*this.ms1)),i=this.long0,r<=1e-10?n=this.X0:(n=Math.asin(Math.cos(a)*this.sinX0+t.y*Math.sin(a)*this.cosX0/r),i=bi(this.long0+Math.atan2(t.x*Math.sin(a),r*this.cosX0*Math.cos(a)-t.y*this.sinX0*Math.sin(a)))),s=-1*xi(this.e,Math.tan(.5*(Qt+n)));return t.x=i,t.y=s,t},names:["stere","Stereographic_South_Pole","Polar Stereographic (variant B)"],ssfn_:function(t,i,s){return i*=s,Math.tan(.5*(Qt+t))*Math.pow((1-i)/(1+i),.5*s)}};var _s={init:function(){var t=this.lat0;this.lambda0=this.long0;var i=Math.sin(t),s=this.a,e=1/this.rf,a=2*e-Math.pow(e,2),n=this.e=Math.sqrt(a);this.R=this.k0*s*Math.sqrt(1-a)/(1-a*Math.pow(i,2)),this.alpha=Math.sqrt(1+a/(1-a)*Math.pow(Math.cos(t),4)),this.b0=Math.asin(i/this.alpha);var r=Math.log(Math.tan(Math.PI/4+this.b0/2)),h=Math.log(Math.tan(Math.PI/4+t/2)),o=Math.log((1+n*i)/(1-n*i));this.K=r-this.alpha*h+this.alpha*n/2*o},forward:function(t){var i=Math.log(Math.tan(Math.PI/4-t.y/2)),s=this.e/2*Math.log((1+this.e*Math.sin(t.y))/(1-this.e*Math.sin(t.y))),e=-this.alpha*(i+s)+this.K,a=2*(Math.atan(Math.exp(e))-Math.PI/4),n=this.alpha*(t.x-this.lambda0),r=Math.atan(Math.sin(n)/(Math.sin(this.b0)*Math.tan(a)+Math.cos(this.b0)*Math.cos(n))),h=Math.asin(Math.cos(this.b0)*Math.sin(a)-Math.sin(this.b0)*Math.cos(a)*Math.cos(n));return t.y=this.R/2*Math.log((1+Math.sin(h))/(1-Math.sin(h)))+this.y0,t.x=this.R*r+this.x0,t},inverse:function(t){for(var i=t.x-this.x0,s=t.y-this.y0,e=i/this.R,a=2*(Math.atan(Math.exp(s/this.R))-Math.PI/4),n=Math.asin(Math.cos(this.b0)*Math.sin(a)+Math.sin(this.b0)*Math.cos(a)*Math.cos(e)),r=Math.atan(Math.sin(e)/(Math.cos(this.b0)*Math.cos(e)-Math.sin(this.b0)*Math.tan(a))),h=this.lambda0+r/this.alpha,o=0,l=n,u=-1e3,c=0;Math.abs(l-u)>1e-7;){if(++c>20)return;o=1/this.alpha*(Math.log(Math.tan(Math.PI/4+n/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(l))/2)),u=l,l=2*Math.atan(Math.exp(o))-Math.PI/2}return t.x=h,t.y=l,t},names:["somerc"]};var xs={init:function(){this.no_off=this.no_off||!1,this.no_rot=this.no_rot||!1,isNaN(this.k0)&&(this.k0=1);var t=Math.sin(this.lat0),i=Math.cos(this.lat0),s=this.e*t;this.bl=Math.sqrt(1+this.es/(1-this.es)*Math.pow(i,4)),this.al=this.a*this.bl*this.k0*Math.sqrt(1-this.es)/(1-s*s);var e,a,n=_i(this.e,this.lat0,t),r=this.bl/i*Math.sqrt((1-this.es)/(1-s*s));if(r*r<1&&(r=1),isNaN(this.longc)){var h=_i(this.e,this.lat1,Math.sin(this.lat1)),o=_i(this.e,this.lat2,Math.sin(this.lat2));this.lat0>=0?this.el=(r+Math.sqrt(r*r-1))*Math.pow(n,this.bl):this.el=(r-Math.sqrt(r*r-1))*Math.pow(n,this.bl);var l=Math.pow(h,this.bl),u=Math.pow(o,this.bl);a=.5*((e=this.el/l)-1/e);var c=(this.el*this.el-u*l)/(this.el*this.el+u*l),f=(u-l)/(u+l),d=bi(this.long1-this.long2);this.long0=.5*(this.long1+this.long2)-Math.atan(c*Math.tan(.5*this.bl*d)/f)/this.bl,this.long0=bi(this.long0);var M=bi(this.long1-this.long0);this.gamma0=Math.atan(Math.sin(this.bl*M)/a),this.alpha=Math.asin(r*Math.sin(this.gamma0))}else e=this.lat0>=0?r+Math.sqrt(r*r-1):r-Math.sqrt(r*r-1),this.el=e*Math.pow(n,this.bl),a=.5*(e-1/e),this.gamma0=Math.asin(Math.sin(this.alpha)/r),this.long0=this.longc-Math.asin(a*Math.tan(this.gamma0))/this.bl;this.no_off?this.uc=0:this.lat0>=0?this.uc=this.al/this.bl*Math.atan2(Math.sqrt(r*r-1),Math.cos(this.alpha)):this.uc=-1*this.al/this.bl*Math.atan2(Math.sqrt(r*r-1),Math.cos(this.alpha))},forward:function(t){var i,s,e,a=t.x,n=t.y,r=bi(a-this.long0);if(Math.abs(Math.abs(n)-Qt)<=1e-10)e=n>0?-1:1,s=this.al/this.bl*Math.log(Math.tan(Ht+e*this.gamma0*.5)),i=-1*e*Qt*this.al/this.bl;else{var h=_i(this.e,n,Math.sin(n)),o=this.el/Math.pow(h,this.bl),l=.5*(o-1/o),u=.5*(o+1/o),c=Math.sin(this.bl*r),f=(l*Math.sin(this.gamma0)-c*Math.cos(this.gamma0))/u;s=Math.abs(Math.abs(f)-1)<=1e-10?Number.POSITIVE_INFINITY:.5*this.al*Math.log((1-f)/(1+f))/this.bl,i=Math.abs(Math.cos(this.bl*r))<=1e-10?this.al*this.bl*r:this.al*Math.atan2(l*Math.cos(this.gamma0)+c*Math.sin(this.gamma0),Math.cos(this.bl*r))/this.bl}return this.no_rot?(t.x=this.x0+i,t.y=this.y0+s):(i-=this.uc,t.x=this.x0+s*Math.cos(this.alpha)+i*Math.sin(this.alpha),t.y=this.y0+i*Math.cos(this.alpha)-s*Math.sin(this.alpha)),t},inverse:function(t){var i,s;this.no_rot?(s=t.y-this.y0,i=t.x-this.x0):(s=(t.x-this.x0)*Math.cos(this.alpha)-(t.y-this.y0)*Math.sin(this.alpha),i=(t.y-this.y0)*Math.cos(this.alpha)+(t.x-this.x0)*Math.sin(this.alpha),i+=this.uc);var e=Math.exp(-1*this.bl*s/this.al),a=.5*(e-1/e),n=.5*(e+1/e),r=Math.sin(this.bl*i/this.al),h=(r*Math.cos(this.gamma0)+a*Math.sin(this.gamma0))/n,o=Math.pow(this.el/Math.sqrt((1+h)/(1-h)),1/this.bl);return Math.abs(h-1)<1e-10?(t.x=this.long0,t.y=Qt):Math.abs(h+1)<1e-10?(t.x=this.long0,t.y=-1*Qt):(t.y=xi(this.e,o),t.x=bi(this.long0-Math.atan2(a*Math.cos(this.gamma0)-r*Math.sin(this.gamma0),Math.cos(this.bl*i/this.al))/this.bl)),t},names:["Hotine_Oblique_Mercator","Hotine Oblique Mercator","Hotine_Oblique_Mercator_Azimuth_Natural_Origin","Hotine_Oblique_Mercator_Azimuth_Center","omerc"]};var ws={init:function(){if(this.lat2||(this.lat2=this.lat1),this.k0||(this.k0=1),this.x0=this.x0||0,this.y0=this.y0||0,!(Math.abs(this.lat1+this.lat2)<1e-10)){var t=this.b/this.a;this.e=Math.sqrt(1-t*t);var i=Math.sin(this.lat1),s=Math.cos(this.lat1),e=yi(this.e,i,s),a=_i(this.e,this.lat1,i),n=Math.sin(this.lat2),r=Math.cos(this.lat2),h=yi(this.e,n,r),o=_i(this.e,this.lat2,n),l=_i(this.e,this.lat0,Math.sin(this.lat0));Math.abs(this.lat1-this.lat2)>1e-10?this.ns=Math.log(e/h)/Math.log(a/o):this.ns=i,isNaN(this.ns)&&(this.ns=i),this.f0=e/(this.ns*Math.pow(a,this.ns)),this.rh=this.a*this.f0*Math.pow(l,this.ns),this.title||(this.title="Lambert Conformal Conic")}},forward:function(t){var i=t.x,s=t.y;Math.abs(2*Math.abs(s)-Math.PI)<=1e-10&&(s=vi(s)*(Qt-2e-10));var e,a,n=Math.abs(Math.abs(s)-Qt);if(n>1e-10)e=_i(this.e,s,Math.sin(s)),a=this.a*this.f0*Math.pow(e,this.ns);else{if((n=s*this.ns)<=0)return null;a=0}var r=this.ns*bi(i-this.long0);return t.x=this.k0*(a*Math.sin(r))+this.x0,t.y=this.k0*(this.rh-a*Math.cos(r))+this.y0,t},inverse:function(t){var i,s,e,a,n,r=(t.x-this.x0)/this.k0,h=this.rh-(t.y-this.y0)/this.k0;this.ns>0?(i=Math.sqrt(r*r+h*h),s=1):(i=-Math.sqrt(r*r+h*h),s=-1);var o=0;if(0!==i&&(o=Math.atan2(s*r,s*h)),0!==i||this.ns>0){if(s=1/this.ns,e=Math.pow(i/(this.a*this.f0),s),-9999===(a=xi(this.e,e)))return null}else a=-Qt;return n=bi(o/this.ns+this.long0),t.x=n,t.y=a,t},names:["Lambert Tangential Conformal Conic Projection","Lambert_Conformal_Conic","Lambert_Conformal_Conic_2SP","lcc"]};var Ns={init:function(){this.a=6377397.155,this.es=.006674372230614,this.e=Math.sqrt(this.es),this.lat0||(this.lat0=.863937979737193),this.long0||(this.long0=.4334234309119251),this.k0||(this.k0=.9999),this.s45=.785398163397448,this.s90=2*this.s45,this.fi0=this.lat0,this.e2=this.es,this.e=Math.sqrt(this.e2),this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2)),this.uq=1.04216856380474,this.u0=Math.asin(Math.sin(this.fi0)/this.alfa),this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2),this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g,this.k1=this.k0,this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2)),this.s0=1.37008346281555,this.n=Math.sin(this.s0),this.ro0=this.k1*this.n0/Math.tan(this.s0),this.ad=this.s90-this.uq},forward:function(t){var i,s,e,a,n,r,h,o=t.x,l=t.y,u=bi(o-this.long0);return i=Math.pow((1+this.e*Math.sin(l))/(1-this.e*Math.sin(l)),this.alfa*this.e/2),s=2*(Math.atan(this.k*Math.pow(Math.tan(l/2+this.s45),this.alfa)/i)-this.s45),e=-u*this.alfa,a=Math.asin(Math.cos(this.ad)*Math.sin(s)+Math.sin(this.ad)*Math.cos(s)*Math.cos(e)),n=Math.asin(Math.cos(s)*Math.sin(e)/Math.cos(a)),r=this.n*n,h=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(a/2+this.s45),this.n),t.y=h*Math.cos(r)/1,t.x=h*Math.sin(r)/1,this.czech||(t.y*=-1,t.x*=-1),t},inverse:function(t){var i,s,e,a,n,r,h,o=t.x;t.x=t.y,t.y=o,this.czech||(t.y*=-1,t.x*=-1),n=Math.sqrt(t.x*t.x+t.y*t.y),a=Math.atan2(t.y,t.x)/Math.sin(this.s0),e=2*(Math.atan(Math.pow(this.ro0/n,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45),i=Math.asin(Math.cos(this.ad)*Math.sin(e)-Math.sin(this.ad)*Math.cos(e)*Math.cos(a)),s=Math.asin(Math.cos(e)*Math.sin(a)/Math.cos(i)),t.x=this.long0-s/this.alfa,r=i,h=0;var l=0;do{t.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(i/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(r))/(1-this.e*Math.sin(r)),this.e/2))-this.s45),Math.abs(r-t.y)<1e-10&&(h=1),r=t.y,l+=1}while(0===h&&l<15);return l>=15?null:t},names:["Krovak","krovak"]};function Cs(t,i,s,e,a){return t*a-i*Math.sin(2*a)+s*Math.sin(4*a)-e*Math.sin(6*a)}function Ps(t){return 1-.25*t*(1+t/16*(3+1.25*t))}function Ss(t){return.375*t*(1+.25*t*(1+.46875*t))}function As(t){return.05859375*t*t*(1+.75*t)}function Es(t){return t*t*t*(35/3072)}function Os(t,i,s){var e=i*s;return t/Math.sqrt(1-e*e)}function ks(t){return Math.abs(t)<Qt?t:t-vi(t)*Math.PI}function Is(t,i,s,e,a){var n,r;n=t/i;for(var h=0;h<15;h++)if(n+=r=(t-(i*n-s*Math.sin(2*n)+e*Math.sin(4*n)-a*Math.sin(6*n)))/(i-2*s*Math.cos(2*n)+4*e*Math.cos(4*n)-6*a*Math.cos(6*n)),Math.abs(r)<=1e-10)return n;return NaN}var Ts={init:function(){this.sphere||(this.e0=Ps(this.es),this.e1=Ss(this.es),this.e2=As(this.es),this.e3=Es(this.es),this.ml0=this.a*Cs(this.e0,this.e1,this.e2,this.e3,this.lat0))},forward:function(t){var i,s,e=t.x,a=t.y;if(e=bi(e-this.long0),this.sphere)i=this.a*Math.asin(Math.cos(a)*Math.sin(e)),s=this.a*(Math.atan2(Math.tan(a),Math.cos(e))-this.lat0);else{var n=Math.sin(a),r=Math.cos(a),h=Os(this.a,this.e,n),o=Math.tan(a)*Math.tan(a),l=e*Math.cos(a),u=l*l,c=this.es*r*r/(1-this.es);i=h*l*(1-u*o*(1/6-(8-o+8*c)*u/120)),s=this.a*Cs(this.e0,this.e1,this.e2,this.e3,a)-this.ml0+h*n/r*u*(.5+(5-o+6*c)*u/24)}return t.x=i+this.x0,t.y=s+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var i,s,e=t.x/this.a,a=t.y/this.a;if(this.sphere){var n=a+this.lat0;i=Math.asin(Math.sin(n)*Math.cos(e)),s=Math.atan2(Math.tan(e),Math.cos(n))}else{var r=Is(this.ml0/this.a+a,this.e0,this.e1,this.e2,this.e3);if(Math.abs(Math.abs(r)-Qt)<=1e-10)return t.x=this.long0,t.y=Qt,a<0&&(t.y*=-1),t;var h=Os(this.a,this.e,Math.sin(r)),o=h*h*h/this.a/this.a*(1-this.es),l=Math.pow(Math.tan(r),2),u=e*this.a/h,c=u*u;i=r-h*Math.tan(r)/o*u*u*(.5-(1+3*l)*u*u/24),s=u*(1-c*(l/3+(1+3*l)*l*c/15))/Math.cos(r)}return t.x=bi(s+this.long0),t.y=ks(i),t},names:["Cassini","Cassini_Soldner","cass"]};function js(t,i){var s;return t>1e-7?(1-t*t)*(i/(1-(s=t*i)*s)-.5/t*Math.log((1-s)/(1+s))):2*i}var qs={init:function(){var t,i=Math.abs(this.lat0);if(Math.abs(i-Qt)<1e-10?this.mode=this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(i)<1e-10?this.mode=this.EQUIT:this.mode=this.OBLIQ,this.es>0)switch(this.qp=js(this.e,1),this.mmf=.5/(1-this.es),this.apa=function(t){var i,s=[];return s[0]=.3333333333333333*t,i=t*t,s[0]+=.17222222222222222*i,s[1]=.06388888888888888*i,i*=t,s[0]+=.10257936507936508*i,s[1]+=.0664021164021164*i,s[2]=.016415012942191543*i,s}(this.es),this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp),this.dd=1/this.rq,this.xmf=1,this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp),t=Math.sin(this.lat0),this.sinb1=js(this.e,t)/this.qp,this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1),this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1),this.ymf=(this.xmf=this.rq)/this.dd,this.xmf*=this.dd}else this.mode===this.OBLIQ&&(this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0))},forward:function(t){var i,s,e,a,n,r,h,o,l,u,c=t.x,f=t.y;if(c=bi(c-this.long0),this.sphere){if(n=Math.sin(f),u=Math.cos(f),e=Math.cos(c),this.mode===this.OBLIQ||this.mode===this.EQUIT){if((s=this.mode===this.EQUIT?1+u*e:1+this.sinph0*n+this.cosph0*u*e)<=1e-10)return null;i=(s=Math.sqrt(2/s))*u*Math.sin(c),s*=this.mode===this.EQUIT?n:this.cosph0*n-this.sinph0*u*e}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(e=-e),Math.abs(f+this.phi0)<1e-10)return null;s=Ht-.5*f,i=(s=2*(this.mode===this.S_POLE?Math.cos(s):Math.sin(s)))*Math.sin(c),s*=e}}else{switch(h=0,o=0,l=0,e=Math.cos(c),a=Math.sin(c),n=Math.sin(f),r=js(this.e,n),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(h=r/this.qp,o=Math.sqrt(1-h*h)),this.mode){case this.OBLIQ:l=1+this.sinb1*h+this.cosb1*o*e;break;case this.EQUIT:l=1+o*e;break;case this.N_POLE:l=Qt+f,r=this.qp-r;break;case this.S_POLE:l=f-Qt,r=this.qp+r}if(Math.abs(l)<1e-10)return null;switch(this.mode){case this.OBLIQ:case this.EQUIT:l=Math.sqrt(2/l),s=this.mode===this.OBLIQ?this.ymf*l*(this.cosb1*h-this.sinb1*o*e):(l=Math.sqrt(2/(1+o*e)))*h*this.ymf,i=this.xmf*l*o*a;break;case this.N_POLE:case this.S_POLE:r>=0?(i=(l=Math.sqrt(r))*a,s=e*(this.mode===this.S_POLE?l:-l)):i=s=0}}return t.x=this.a*i+this.x0,t.y=this.a*s+this.y0,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var i,s,e,a,n,r,h,o,l,u,c=t.x/this.a,f=t.y/this.a;if(this.sphere){var d,M=0,p=0;if((s=.5*(d=Math.sqrt(c*c+f*f)))>1)return null;switch(s=2*Math.asin(s),this.mode!==this.OBLIQ&&this.mode!==this.EQUIT||(p=Math.sin(s),M=Math.cos(s)),this.mode){case this.EQUIT:s=Math.abs(d)<=1e-10?0:Math.asin(f*p/d),c*=p,f=M*d;break;case this.OBLIQ:s=Math.abs(d)<=1e-10?this.phi0:Math.asin(M*this.sinph0+f*p*this.cosph0/d),c*=p*this.cosph0,f=(M-Math.sin(s)*this.sinph0)*d;break;case this.N_POLE:f=-f,s=Qt-s;break;case this.S_POLE:s-=Qt}i=0!==f||this.mode!==this.EQUIT&&this.mode!==this.OBLIQ?Math.atan2(c,f):0}else{if(h=0,this.mode===this.OBLIQ||this.mode===this.EQUIT){if(c/=this.dd,f*=this.dd,(r=Math.sqrt(c*c+f*f))<1e-10)return t.x=0,t.y=this.phi0,t;a=2*Math.asin(.5*r/this.rq),e=Math.cos(a),c*=a=Math.sin(a),this.mode===this.OBLIQ?(h=e*this.sinb1+f*a*this.cosb1/r,n=this.qp*h,f=r*this.cosb1*e-f*this.sinb1*a):(h=f*a/r,n=this.qp*h,f=r*e)}else if(this.mode===this.N_POLE||this.mode===this.S_POLE){if(this.mode===this.N_POLE&&(f=-f),!(n=c*c+f*f))return t.x=0,t.y=this.phi0,t;h=1-n/this.qp,this.mode===this.S_POLE&&(h=-h)}i=Math.atan2(c,f),o=Math.asin(h),l=this.apa,u=o+o,s=o+l[0]*Math.sin(u)+l[1]*Math.sin(u+u)+l[2]*Math.sin(u+u+u)}return t.x=bi(this.long0+i),t.y=s,t},names:["Lambert Azimuthal Equal Area","Lambert_Azimuthal_Equal_Area","laea"],S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4};function Rs(t){return Math.abs(t)>1&&(t=t>1?1:-1),Math.asin(t)}var Fs={init:function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e3=Math.sqrt(this.es),this.sin_po=Math.sin(this.lat1),this.cos_po=Math.cos(this.lat1),this.t1=this.sin_po,this.con=this.sin_po,this.ms1=yi(this.e3,this.sin_po,this.cos_po),this.qs1=js(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat2),this.cos_po=Math.cos(this.lat2),this.t2=this.sin_po,this.ms2=yi(this.e3,this.sin_po,this.cos_po),this.qs2=js(this.e3,this.sin_po,this.cos_po),this.sin_po=Math.sin(this.lat0),this.cos_po=Math.cos(this.lat0),this.t3=this.sin_po,this.qs0=js(this.e3,this.sin_po,this.cos_po),Math.abs(this.lat1-this.lat2)>1e-10?this.ns0=(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.ns0=this.con,this.c=this.ms1*this.ms1+this.ns0*this.qs1,this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0)},forward:function(t){var i=t.x,s=t.y;this.sin_phi=Math.sin(s),this.cos_phi=Math.cos(s);var e=js(this.e3,this.sin_phi,this.cos_phi),a=this.a*Math.sqrt(this.c-this.ns0*e)/this.ns0,n=this.ns0*bi(i-this.long0),r=a*Math.sin(n)+this.x0,h=this.rh-a*Math.cos(n)+this.y0;return t.x=r,t.y=h,t},inverse:function(t){var i,s,e,a,n,r;return t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns0>=0?(i=Math.sqrt(t.x*t.x+t.y*t.y),e=1):(i=-Math.sqrt(t.x*t.x+t.y*t.y),e=-1),a=0,0!==i&&(a=Math.atan2(e*t.x,e*t.y)),e=i*this.ns0/this.a,this.sphere?r=Math.asin((this.c-e*e)/(2*this.ns0)):(s=(this.c-e*e)/this.ns0,r=this.phi1z(this.e3,s)),n=bi(a/this.ns0+this.long0),t.x=n,t.y=r,t},names:["Albers_Conic_Equal_Area","Albers","aea"],phi1z:function(t,i){var s,e,a,n,r=Rs(.5*i);if(t<1e-10)return r;for(var h=t*t,o=1;o<=25;o++)if(r+=n=.5*(a=1-(e=t*(s=Math.sin(r)))*e)*a/Math.cos(r)*(i/(1-h)-s/a+.5/t*Math.log((1-e)/(1+e))),Math.abs(n)<=1e-7)return r;return null}};var Ds={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0),this.infinity_dist=1e3*this.a,this.rc=1},forward:function(t){var i,s,e,a,n,r,h,o=t.x,l=t.y;return e=bi(o-this.long0),i=Math.sin(l),s=Math.cos(l),a=Math.cos(e),1,(n=this.sin_p14*i+this.cos_p14*s*a)>0||Math.abs(n)<=1e-10?(r=this.x0+1*this.a*s*Math.sin(e)/n,h=this.y0+1*this.a*(this.cos_p14*i-this.sin_p14*s*a)/n):(r=this.x0+this.infinity_dist*s*Math.sin(e),h=this.y0+this.infinity_dist*(this.cos_p14*i-this.sin_p14*s*a)),t.x=r,t.y=h,t},inverse:function(t){var i,s,e,a,n,r;return t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,t.x/=this.k0,t.y/=this.k0,(i=Math.sqrt(t.x*t.x+t.y*t.y))?(a=Math.atan2(i,this.rc),s=Math.sin(a),r=Rs((e=Math.cos(a))*this.sin_p14+t.y*s*this.cos_p14/i),n=Math.atan2(t.x*s,i*this.cos_p14*e-t.y*this.sin_p14*s),n=bi(this.long0+n)):(r=this.phic0,n=0),t.x=n,t.y=r,t},names:["gnom"]};var Ls={init:function(){this.sphere||(this.k0=yi(this.e,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(t){var i,s,e=t.x,a=t.y,n=bi(e-this.long0);if(this.sphere)i=this.x0+this.a*n*Math.cos(this.lat_ts),s=this.y0+this.a*Math.sin(a)/Math.cos(this.lat_ts);else{var r=js(this.e,Math.sin(a));i=this.x0+this.a*this.k0*n,s=this.y0+this.a*r*.5/this.k0}return t.x=i,t.y=s,t},inverse:function(t){var i,s;return t.x-=this.x0,t.y-=this.y0,this.sphere?(i=bi(this.long0+t.x/this.a/Math.cos(this.lat_ts)),s=Math.asin(t.y/this.a*Math.cos(this.lat_ts))):(s=function(t,i){var s=1-(1-t*t)/(2*t)*Math.log((1-t)/(1+t));if(Math.abs(Math.abs(i)-s)<1e-6)return i<0?-1*Qt:Qt;for(var e,a,n,r,h=Math.asin(.5*i),o=0;o<30;o++)if(a=Math.sin(h),n=Math.cos(h),r=t*a,h+=e=Math.pow(1-r*r,2)/(2*n)*(i/(1-t*t)-a/(1-r*r)+.5/t*Math.log((1-r)/(1+r))),Math.abs(e)<=1e-10)return h;return NaN}(this.e,2*t.y*this.k0/this.a),i=bi(this.long0+t.x/(this.a*this.k0))),t.x=i,t.y=s,t},names:["cea"]};var Gs={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Equidistant Cylindrical (Plate Carre)",this.rc=Math.cos(this.lat_ts)},forward:function(t){var i=t.x,s=t.y,e=bi(i-this.long0),a=ks(s-this.lat0);return t.x=this.x0+this.a*e*this.rc,t.y=this.y0+this.a*a,t},inverse:function(t){var i=t.x,s=t.y;return t.x=bi(this.long0+(i-this.x0)/(this.a*this.rc)),t.y=ks(this.lat0+(s-this.y0)/this.a),t},names:["Equirectangular","Equidistant_Cylindrical","eqc"]};var zs={init:function(){this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ps(this.es),this.e1=Ss(this.es),this.e2=As(this.es),this.e3=Es(this.es),this.ml0=this.a*Cs(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(t){var i,s,e,a=t.x,n=t.y,r=bi(a-this.long0);if(e=r*Math.sin(n),this.sphere)Math.abs(n)<=1e-10?(i=this.a*r,s=-1*this.a*this.lat0):(i=this.a*Math.sin(e)/Math.tan(n),s=this.a*(ks(n-this.lat0)+(1-Math.cos(e))/Math.tan(n)));else if(Math.abs(n)<=1e-10)i=this.a*r,s=-1*this.ml0;else{var h=Os(this.a,this.e,Math.sin(n))/Math.tan(n);i=h*Math.sin(e),s=this.a*Cs(this.e0,this.e1,this.e2,this.e3,n)-this.ml0+h*(1-Math.cos(e))}return t.x=i+this.x0,t.y=s+this.y0,t},inverse:function(t){var i,s,e,a,n,r,h,o,l;if(e=t.x-this.x0,a=t.y-this.y0,this.sphere)if(Math.abs(a+this.a*this.lat0)<=1e-10)i=bi(e/this.a+this.long0),s=0;else{var u;for(r=this.lat0+a/this.a,h=e*e/this.a/this.a+r*r,o=r,n=20;n;--n)if(o+=l=-1*(r*(o*(u=Math.tan(o))+1)-o-.5*(o*o+h)*u)/((o-r)/u-1),Math.abs(l)<=1e-10){s=o;break}i=bi(this.long0+Math.asin(e*Math.tan(o)/this.a)/Math.sin(s))}else if(Math.abs(a+this.ml0)<=1e-10)s=0,i=bi(this.long0+e/this.a);else{var c,f,d,M,p;for(r=(this.ml0+a)/this.a,h=e*e/this.a/this.a+r*r,o=r,n=20;n;--n)if(p=this.e*Math.sin(o),c=Math.sqrt(1-p*p)*Math.tan(o),f=this.a*Cs(this.e0,this.e1,this.e2,this.e3,o),d=this.e0-2*this.e1*Math.cos(2*o)+4*this.e2*Math.cos(4*o)-6*this.e3*Math.cos(6*o),o-=l=(r*(c*(M=f/this.a)+1)-M-.5*c*(M*M+h))/(this.es*Math.sin(2*o)*(M*M+h-2*r*M)/(4*c)+(r-M)*(c*d-2/Math.sin(2*o))-d),Math.abs(l)<=1e-10){s=o;break}c=Math.sqrt(1-this.es*Math.pow(Math.sin(s),2))*Math.tan(s),i=bi(this.long0+Math.asin(e*c/this.a)/Math.sin(s))}return t.x=i,t.y=s,t},names:["Polyconic","poly"]};var Bs={init:function(){this.A=[],this.A[1]=.6399175073,this.A[2]=-.1358797613,this.A[3]=.063294409,this.A[4]=-.02526853,this.A[5]=.0117879,this.A[6]=-.0055161,this.A[7]=.0026906,this.A[8]=-.001333,this.A[9]=67e-5,this.A[10]=-34e-5,this.B_re=[],this.B_im=[],this.B_re[1]=.7557853228,this.B_im[1]=0,this.B_re[2]=.249204646,this.B_im[2]=.003371507,this.B_re[3]=-.001541739,this.B_im[3]=.04105856,this.B_re[4]=-.10162907,this.B_im[4]=.01727609,this.B_re[5]=-.26623489,this.B_im[5]=-.36249218,this.B_re[6]=-.6870983,this.B_im[6]=-1.1651967,this.C_re=[],this.C_im=[],this.C_re[1]=1.3231270439,this.C_im[1]=0,this.C_re[2]=-.577245789,this.C_im[2]=-.007809598,this.C_re[3]=.508307513,this.C_im[3]=-.112208952,this.C_re[4]=-.15094762,this.C_im[4]=.18200602,this.C_re[5]=1.01418179,this.C_im[5]=1.64497696,this.C_re[6]=1.9660549,this.C_im[6]=2.5127645,this.D=[],this.D[1]=1.5627014243,this.D[2]=.5185406398,this.D[3]=-.03333098,this.D[4]=-.1052906,this.D[5]=-.0368594,this.D[6]=.007317,this.D[7]=.0122,this.D[8]=.00394,this.D[9]=-.0013},forward:function(t){var i,s=t.x,e=t.y-this.lat0,a=s-this.long0,n=e/Jt*1e-5,r=a,h=1,o=0;for(i=1;i<=10;i++)h*=n,o+=this.A[i]*h;var l,u=o,c=r,f=1,d=0,M=0,p=0;for(i=1;i<=6;i++)l=d*u+f*c,f=f*u-d*c,d=l,M=M+this.B_re[i]*f-this.B_im[i]*d,p=p+this.B_im[i]*f+this.B_re[i]*d;return t.x=p*this.a+this.x0,t.y=M*this.a+this.y0,t},inverse:function(t){var i,s,e=t.x,a=t.y,n=e-this.x0,r=(a-this.y0)/this.a,h=n/this.a,o=1,l=0,u=0,c=0;for(i=1;i<=6;i++)s=l*r+o*h,o=o*r-l*h,l=s,u=u+this.C_re[i]*o-this.C_im[i]*l,c=c+this.C_im[i]*o+this.C_re[i]*l;for(var f=0;f<this.iterations;f++){var d,M=u,p=c,m=r,g=h;for(i=2;i<=6;i++)d=p*u+M*c,M=M*u-p*c,p=d,m+=(i-1)*(this.B_re[i]*M-this.B_im[i]*p),g+=(i-1)*(this.B_im[i]*M+this.B_re[i]*p);M=1,p=0;var y=this.B_re[1],v=this.B_im[1];for(i=2;i<=6;i++)d=p*u+M*c,M=M*u-p*c,p=d,y+=i*(this.B_re[i]*M-this.B_im[i]*p),v+=i*(this.B_im[i]*M+this.B_re[i]*p);var b=y*y+v*v;u=(m*y+g*v)/b,c=(g*y-m*v)/b}var _=u,x=c,w=1,N=0;for(i=1;i<=9;i++)w*=_,N+=this.D[i]*w;var C=this.lat0+N*Jt*1e5,P=this.long0+x;return t.x=P,t.y=C,t},names:["New_Zealand_Map_Grid","nzmg"]};var Us={init:function(){},forward:function(t){var i=t.x,s=t.y,e=bi(i-this.long0),a=this.x0+this.a*e,n=this.y0+this.a*Math.log(Math.tan(Math.PI/4+s/2.5))*1.25;return t.x=a,t.y=n,t},inverse:function(t){t.x-=this.x0,t.y-=this.y0;var i=bi(this.long0+t.x/this.a),s=2.5*(Math.atan(Math.exp(.8*t.y/this.a))-Math.PI/4);return t.x=i,t.y=s,t},names:["Miller_Cylindrical","mill"]};var Vs={init:function(){this.sphere?(this.n=1,this.m=0,this.es=0,this.C_y=Math.sqrt((this.m+1)/this.n),this.C_x=this.C_y/(this.m+1)):this.en=rs(this.es)},forward:function(t){var i,s,e=t.x,a=t.y;if(e=bi(e-this.long0),this.sphere){if(this.m)for(var n=this.n*Math.sin(a),r=20;r;--r){var h=(this.m*a+Math.sin(a)-n)/(this.m+Math.cos(a));if(a-=h,Math.abs(h)<1e-10)break}else a=1!==this.n?Math.asin(this.n*Math.sin(a)):a;i=this.a*this.C_x*e*(this.m+Math.cos(a)),s=this.a*this.C_y*a}else{var o=Math.sin(a),l=Math.cos(a);s=this.a*hs(a,o,l,this.en),i=this.a*e*l/Math.sqrt(1-this.es*o*o)}return t.x=i,t.y=s,t},inverse:function(t){var i,s,e;return t.x-=this.x0,s=t.x/this.a,t.y-=this.y0,i=t.y/this.a,this.sphere?(i/=this.C_y,s/=this.C_x*(this.m+Math.cos(i)),this.m?i=Rs((this.m*i+Math.sin(i))/this.n):1!==this.n&&(i=Rs(Math.sin(i)/this.n)),s=bi(s+this.long0),i=ks(i)):(i=os(t.y/this.a,this.es,this.en),(e=Math.abs(i))<Qt?(e=Math.sin(i),s=bi(this.long0+t.x*Math.sqrt(1-this.es*e*e)/(this.a*Math.cos(i)))):e-1e-10<Qt&&(s=this.long0)),t.x=s,t.y=i,t},names:["Sinusoidal","sinu"]};var Js={init:function(){},forward:function(t){for(var i=t.x,s=t.y,e=bi(i-this.long0),a=s,n=Math.PI*Math.sin(s);;){var r=-(a+Math.sin(a)-n)/(1+Math.cos(a));if(a+=r,Math.abs(r)<1e-10)break}a/=2,Math.PI/2-Math.abs(s)<1e-10&&(e=0);var h=.900316316158*this.a*e*Math.cos(a)+this.x0,o=1.4142135623731*this.a*Math.sin(a)+this.y0;return t.x=h,t.y=o,t},inverse:function(t){var i,s;t.x-=this.x0,t.y-=this.y0,s=t.y/(1.4142135623731*this.a),Math.abs(s)>.999999999999&&(s=.999999999999),i=Math.asin(s);var e=bi(this.long0+t.x/(.900316316158*this.a*Math.cos(i)));e<-Math.PI&&(e=-Math.PI),e>Math.PI&&(e=Math.PI),s=(2*i+Math.sin(2*i))/Math.PI,Math.abs(s)>1&&(s=1);var a=Math.asin(s);return t.x=e,t.y=a,t},names:["Mollweide","moll"]};var Qs={init:function(){Math.abs(this.lat1+this.lat2)<1e-10||(this.lat2=this.lat2||this.lat1,this.temp=this.b/this.a,this.es=1-Math.pow(this.temp,2),this.e=Math.sqrt(this.es),this.e0=Ps(this.es),this.e1=Ss(this.es),this.e2=As(this.es),this.e3=Es(this.es),this.sinphi=Math.sin(this.lat1),this.cosphi=Math.cos(this.lat1),this.ms1=yi(this.e,this.sinphi,this.cosphi),this.ml1=Cs(this.e0,this.e1,this.e2,this.e3,this.lat1),Math.abs(this.lat1-this.lat2)<1e-10?this.ns=this.sinphi:(this.sinphi=Math.sin(this.lat2),this.cosphi=Math.cos(this.lat2),this.ms2=yi(this.e,this.sinphi,this.cosphi),this.ml2=Cs(this.e0,this.e1,this.e2,this.e3,this.lat2),this.ns=(this.ms1-this.ms2)/(this.ml2-this.ml1)),this.g=this.ml1+this.ms1/this.ns,this.ml0=Cs(this.e0,this.e1,this.e2,this.e3,this.lat0),this.rh=this.a*(this.g-this.ml0))},forward:function(t){var i,s=t.x,e=t.y;if(this.sphere)i=this.a*(this.g-e);else{var a=Cs(this.e0,this.e1,this.e2,this.e3,e);i=this.a*(this.g-a)}var n=this.ns*bi(s-this.long0),r=this.x0+i*Math.sin(n),h=this.y0+this.rh-i*Math.cos(n);return t.x=r,t.y=h,t},inverse:function(t){var i,s,e,a;t.x-=this.x0,t.y=this.rh-t.y+this.y0,this.ns>=0?(s=Math.sqrt(t.x*t.x+t.y*t.y),i=1):(s=-Math.sqrt(t.x*t.x+t.y*t.y),i=-1);var n=0;return 0!==s&&(n=Math.atan2(i*t.x,i*t.y)),this.sphere?(a=bi(this.long0+n/this.ns),e=ks(this.g-s/this.a),t.x=a,t.y=e,t):(e=Is(this.g-s/this.a,this.e0,this.e1,this.e2,this.e3),a=bi(this.long0+n/this.ns),t.x=a,t.y=e,t)},names:["Equidistant_Conic","eqdc"]};var Ws={init:function(){this.R=this.a},forward:function(t){var i,s,e=t.x,a=t.y,n=bi(e-this.long0);Math.abs(a)<=1e-10&&(i=this.x0+this.R*n,s=this.y0);var r=Rs(2*Math.abs(a/Math.PI));(Math.abs(n)<=1e-10||Math.abs(Math.abs(a)-Qt)<=1e-10)&&(i=this.x0,s=a>=0?this.y0+Math.PI*this.R*Math.tan(.5*r):this.y0+Math.PI*this.R*-Math.tan(.5*r));var h=.5*Math.abs(Math.PI/n-n/Math.PI),o=h*h,l=Math.sin(r),u=Math.cos(r),c=u/(l+u-1),f=c*c,d=c*(2/l-1),M=d*d,p=Math.PI*this.R*(h*(c-M)+Math.sqrt(o*(c-M)*(c-M)-(M+o)*(f-M)))/(M+o);n<0&&(p=-p),i=this.x0+p;var m=o+c;return p=Math.PI*this.R*(d*m-h*Math.sqrt((M+o)*(o+1)-m*m))/(M+o),s=a>=0?this.y0+p:this.y0-p,t.x=i,t.y=s,t},inverse:function(t){var i,s,e,a,n,r,h,o,l,u,c,f;return t.x-=this.x0,t.y-=this.y0,c=Math.PI*this.R,n=(e=t.x/c)*e+(a=t.y/c)*a,c=3*(a*a/(o=-2*(r=-Math.abs(a)*(1+n))+1+2*a*a+n*n)+(2*(h=r-2*a*a+e*e)*h*h/o/o/o-9*r*h/o/o)/27)/(l=(r-h*h/3/o)/o)/(u=2*Math.sqrt(-l/3)),Math.abs(c)>1&&(c=c>=0?1:-1),f=Math.acos(c)/3,s=t.y>=0?(-u*Math.cos(f+Math.PI/3)-h/3/o)*Math.PI:-(-u*Math.cos(f+Math.PI/3)-h/3/o)*Math.PI,i=Math.abs(e)<1e-10?this.long0:bi(this.long0+Math.PI*(n-1+Math.sqrt(1+2*(e*e-a*a)+n*n))/2/e),t.x=i,t.y=s,t},names:["Van_der_Grinten_I","VanDerGrinten","vandg"]};var Xs={init:function(){this.sin_p12=Math.sin(this.lat0),this.cos_p12=Math.cos(this.lat0)},forward:function(t){var i,s,e,a,n,r,h,o,l,u,c,f,d,M,p,m,g,y,v,b,_,x,w=t.x,N=t.y,C=Math.sin(t.y),P=Math.cos(t.y),S=bi(w-this.long0);return this.sphere?Math.abs(this.sin_p12-1)<=1e-10?(t.x=this.x0+this.a*(Qt-N)*Math.sin(S),t.y=this.y0-this.a*(Qt-N)*Math.cos(S),t):Math.abs(this.sin_p12+1)<=1e-10?(t.x=this.x0+this.a*(Qt+N)*Math.sin(S),t.y=this.y0+this.a*(Qt+N)*Math.cos(S),t):(y=this.sin_p12*C+this.cos_p12*P*Math.cos(S),g=(m=Math.acos(y))/Math.sin(m),t.x=this.x0+this.a*g*P*Math.sin(S),t.y=this.y0+this.a*g*(this.cos_p12*C-this.sin_p12*P*Math.cos(S)),t):(i=Ps(this.es),s=Ss(this.es),e=As(this.es),a=Es(this.es),Math.abs(this.sin_p12-1)<=1e-10?(n=this.a*Cs(i,s,e,a,Qt),r=this.a*Cs(i,s,e,a,N),t.x=this.x0+(n-r)*Math.sin(S),t.y=this.y0-(n-r)*Math.cos(S),t):Math.abs(this.sin_p12+1)<=1e-10?(n=this.a*Cs(i,s,e,a,Qt),r=this.a*Cs(i,s,e,a,N),t.x=this.x0+(n+r)*Math.sin(S),t.y=this.y0+(n+r)*Math.cos(S),t):(h=C/P,o=Os(this.a,this.e,this.sin_p12),l=Os(this.a,this.e,C),u=Math.atan((1-this.es)*h+this.es*o*this.sin_p12/(l*P)),v=0===(c=Math.atan2(Math.sin(S),this.cos_p12*Math.tan(u)-this.sin_p12*Math.cos(S)))?Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.abs(Math.abs(c)-Math.PI)<=1e-10?-Math.asin(this.cos_p12*Math.sin(u)-this.sin_p12*Math.cos(u)):Math.asin(Math.sin(S)*Math.cos(u)/Math.sin(c)),f=this.e*this.sin_p12/Math.sqrt(1-this.es),m=o*v*(1-(b=v*v)*(p=(d=this.e*this.cos_p12*Math.cos(c)/Math.sqrt(1-this.es))*d)*(1-p)/6+(_=b*v)/8*(M=f*d)*(1-2*p)+(x=_*v)/120*(p*(4-7*p)-3*f*f*(1-7*p))-x*v/48*M),t.x=this.x0+m*Math.sin(c),t.y=this.y0+m*Math.cos(c),t))},inverse:function(t){var i,s,e,a,n,r,h,o,l,u,c,f,d,M,p,m,g,y,v,b,_,x;if(t.x-=this.x0,t.y-=this.y0,this.sphere){if((i=Math.sqrt(t.x*t.x+t.y*t.y))>2*Qt*this.a)return;return s=i/this.a,e=Math.sin(s),a=Math.cos(s),n=this.long0,Math.abs(i)<=1e-10?r=this.lat0:(r=Rs(a*this.sin_p12+t.y*e*this.cos_p12/i),h=Math.abs(this.lat0)-Qt,n=Math.abs(h)<=1e-10?this.lat0>=0?bi(this.long0+Math.atan2(t.x,-t.y)):bi(this.long0-Math.atan2(-t.x,t.y)):bi(this.long0+Math.atan2(t.x*e,i*this.cos_p12*a-t.y*this.sin_p12*e))),t.x=n,t.y=r,t}return o=Ps(this.es),l=Ss(this.es),u=As(this.es),c=Es(this.es),Math.abs(this.sin_p12-1)<=1e-10?(r=Is(((f=this.a*Cs(o,l,u,c,Qt))-(i=Math.sqrt(t.x*t.x+t.y*t.y)))/this.a,o,l,u,c),n=bi(this.long0+Math.atan2(t.x,-1*t.y)),t.x=n,t.y=r,t):Math.abs(this.sin_p12+1)<=1e-10?(f=this.a*Cs(o,l,u,c,Qt),r=Is(((i=Math.sqrt(t.x*t.x+t.y*t.y))-f)/this.a,o,l,u,c),n=bi(this.long0+Math.atan2(t.x,t.y)),t.x=n,t.y=r,t):(i=Math.sqrt(t.x*t.x+t.y*t.y),p=Math.atan2(t.x,t.y),d=Os(this.a,this.e,this.sin_p12),m=Math.cos(p),y=-(g=this.e*this.cos_p12*m)*g/(1-this.es),v=3*this.es*(1-y)*this.sin_p12*this.cos_p12*m/(1-this.es),x=1-y*(_=(b=i/d)-y*(1+y)*Math.pow(b,3)/6-v*(1+3*y)*Math.pow(b,4)/24)*_/2-b*_*_*_/6,M=Math.asin(this.sin_p12*Math.cos(_)+this.cos_p12*Math.sin(_)*m),n=bi(this.long0+Math.asin(Math.sin(p)*Math.sin(_)/Math.cos(M))),r=Math.atan((1-this.es*x*this.sin_p12/Math.sin(M))*Math.tan(M)/(1-this.es)),t.x=n,t.y=r,t)},names:["Azimuthal_Equidistant","aeqd"]};var Hs={init:function(){this.sin_p14=Math.sin(this.lat0),this.cos_p14=Math.cos(this.lat0)},forward:function(t){var i,s,e,a,n,r,h,o=t.x,l=t.y;return e=bi(o-this.long0),i=Math.sin(l),s=Math.cos(l),a=Math.cos(e),1,((n=this.sin_p14*i+this.cos_p14*s*a)>0||Math.abs(n)<=1e-10)&&(r=1*this.a*s*Math.sin(e),h=this.y0+1*this.a*(this.cos_p14*i-this.sin_p14*s*a)),t.x=r,t.y=h,t},inverse:function(t){var i,s,e,a,n,r,h;return t.x-=this.x0,t.y-=this.y0,s=Rs((i=Math.sqrt(t.x*t.x+t.y*t.y))/this.a),e=Math.sin(s),a=Math.cos(s),r=this.long0,Math.abs(i)<=1e-10?(h=this.lat0,t.x=r,t.y=h,t):(h=Rs(a*this.sin_p14+t.y*e*this.cos_p14/i),n=Math.abs(this.lat0)-Qt,Math.abs(n)<=1e-10?(r=this.lat0>=0?bi(this.long0+Math.atan2(t.x,-t.y)):bi(this.long0-Math.atan2(-t.x,t.y)),t.x=r,t.y=h,t):(r=bi(this.long0+Math.atan2(t.x*e,i*this.cos_p14*a-t.y*this.sin_p14*e)),t.x=r,t.y=h,t))},names:["ortho"]},$s=1,Ks=2,Zs=3,Ys=4,te=5,ie=6,se=1,ee=2,ae=3,ne=4;function re(t,i,s,e){var a;return t<1e-10?(e.value=se,a=0):(a=Math.atan2(i,s),Math.abs(a)<=Ht?e.value=se:a>Ht&&a<=Qt+Ht?(e.value=ee,a-=Qt):a>Qt+Ht||a<=-(Qt+Ht)?(e.value=ae,a=a>=0?a-Kt:a+Kt):(e.value=ne,a+=Qt)),a}function he(t,i){var s=t+i;return s<-Kt?s+=$t:s>+Kt&&(s-=$t),s}var oe={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.lat0=this.lat0||0,this.long0=this.long0||0,this.lat_ts=this.lat_ts||0,this.title=this.title||"Quadrilateralized Spherical Cube",this.lat0>=Qt-Ht/2?this.face=te:this.lat0<=-(Qt-Ht/2)?this.face=ie:Math.abs(this.long0)<=Ht?this.face=$s:Math.abs(this.long0)<=Qt+Ht?this.face=this.long0>0?Ks:Ys:this.face=Zs,0!==this.es&&(this.one_minus_f=1-(this.a-this.b)/this.a,this.one_minus_f_squared=this.one_minus_f*this.one_minus_f)},forward:function(t){var i,s,e,a,n,r,h={x:0,y:0},o={value:0};if(t.x-=this.long0,i=0!==this.es?Math.atan(this.one_minus_f_squared*Math.tan(t.y)):t.y,s=t.x,this.face===te)a=Qt-i,s>=Ht&&s<=Qt+Ht?(o.value=se,e=s-Qt):s>Qt+Ht||s<=-(Qt+Ht)?(o.value=ee,e=s>0?s-Kt:s+Kt):s>-(Qt+Ht)&&s<=-Ht?(o.value=ae,e=s+Qt):(o.value=ne,e=s);else if(this.face===ie)a=Qt+i,s>=Ht&&s<=Qt+Ht?(o.value=se,e=-s+Qt):s<Ht&&s>=-Ht?(o.value=ee,e=-s):s<-Ht&&s>=-(Qt+Ht)?(o.value=ae,e=-s-Qt):(o.value=ne,e=s>0?-s+Kt:-s-Kt);else{var l,u,c,f,d,M;this.face===Ks?s=he(s,+Qt):this.face===Zs?s=he(s,+Kt):this.face===Ys&&(s=he(s,-Qt)),f=Math.sin(i),d=Math.cos(i),M=Math.sin(s),l=d*Math.cos(s),u=d*M,c=f,this.face===$s?e=re(a=Math.acos(l),c,u,o):this.face===Ks?e=re(a=Math.acos(u),c,-l,o):this.face===Zs?e=re(a=Math.acos(-l),c,-u,o):this.face===Ys?e=re(a=Math.acos(-u),c,l,o):(a=e=0,o.value=se)}return r=Math.atan(12/Kt*(e+Math.acos(Math.sin(e)*Math.cos(Ht))-Qt)),n=Math.sqrt((1-Math.cos(a))/(Math.cos(r)*Math.cos(r))/(1-Math.cos(Math.atan(1/Math.cos(e))))),o.value===ee?r+=Qt:o.value===ae?r+=Kt:o.value===ne&&(r+=1.5*Kt),h.x=n*Math.cos(r),h.y=n*Math.sin(r),h.x=h.x*this.a+this.x0,h.y=h.y*this.a+this.y0,t.x=h.x,t.y=h.y,t},inverse:function(t){var i,s,e,a,n,r,h,o,l,u,c,f,d={lam:0,phi:0},M={value:0};if(t.x=(t.x-this.x0)/this.a,t.y=(t.y-this.y0)/this.a,s=Math.atan(Math.sqrt(t.x*t.x+t.y*t.y)),i=Math.atan2(t.y,t.x),t.x>=0&&t.x>=Math.abs(t.y)?M.value=se:t.y>=0&&t.y>=Math.abs(t.x)?(M.value=ee,i-=Qt):t.x<0&&-t.x>=Math.abs(t.y)?(M.value=ae,i=i<0?i+Kt:i-Kt):(M.value=ne,i+=Qt),l=Kt/12*Math.tan(i),n=Math.sin(l)/(Math.cos(l)-1/Math.sqrt(2)),r=Math.atan(n),(h=1-(e=Math.cos(i))*e*(a=Math.tan(s))*a*(1-Math.cos(Math.atan(1/Math.cos(r)))))<-1?h=-1:h>1&&(h=1),this.face===te)o=Math.acos(h),d.phi=Qt-o,M.value===se?d.lam=r+Qt:M.value===ee?d.lam=r<0?r+Kt:r-Kt:M.value===ae?d.lam=r-Qt:d.lam=r;else if(this.face===ie)o=Math.acos(h),d.phi=o-Qt,M.value===se?d.lam=-r+Qt:M.value===ee?d.lam=-r:M.value===ae?d.lam=-r-Qt:d.lam=r<0?-r-Kt:-r+Kt;else{var p,m,g;l=(p=h)*p,m=(l+=(g=l>=1?0:Math.sqrt(1-l)*Math.sin(r))*g)>=1?0:Math.sqrt(1-l),M.value===ee?(l=m,m=-g,g=l):M.value===ae?(m=-m,g=-g):M.value===ne&&(l=m,m=g,g=-l),this.face===Ks?(l=p,p=-m,m=l):this.face===Zs?(p=-p,m=-m):this.face===Ys&&(l=p,p=m,m=-l),d.phi=Math.acos(-g)-Qt,d.lam=Math.atan2(m,p),this.face===Ks?d.lam=he(d.lam,-Qt):this.face===Zs?d.lam=he(d.lam,-Kt):this.face===Ys&&(d.lam=he(d.lam,+Qt))}return 0!==this.es&&(u=d.phi<0?1:0,c=Math.tan(d.phi),f=this.b/Math.sqrt(c*c+this.one_minus_f_squared),d.phi=Math.atan(Math.sqrt(this.a*this.a-f*f)/(this.one_minus_f*f)),u&&(d.phi=-d.phi)),d.lam+=this.long0,t.x=d.lam,t.y=d.phi,t},names:["Quadrilateralized Spherical Cube","Quadrilateralized_Spherical_Cube","qsc"]},le=[[1,22199e-21,-715515e-10,31103e-10],[.9986,-482243e-9,-24897e-9,-13309e-10],[.9954,-83103e-8,-448605e-10,-9.86701e-7],[.99,-.00135364,-59661e-9,36777e-10],[.9822,-.00167442,-449547e-11,-572411e-11],[.973,-.00214868,-903571e-10,1.8736e-8],[.96,-.00305085,-900761e-10,164917e-11],[.9427,-.00382792,-653386e-10,-26154e-10],[.9216,-.00467746,-10457e-8,481243e-11],[.8962,-.00536223,-323831e-10,-543432e-11],[.8679,-.00609363,-113898e-9,332484e-11],[.835,-.00698325,-640253e-10,9.34959e-7],[.7986,-.00755338,-500009e-10,9.35324e-7],[.7597,-.00798324,-35971e-9,-227626e-11],[.7186,-.00851367,-701149e-10,-86303e-10],[.6732,-.00986209,-199569e-9,191974e-10],[.6213,-.010418,883923e-10,624051e-11],[.5722,-.00906601,182e-6,624051e-11],[.5322,-.00677797,275608e-9,624051e-11]],ue=[[-520417e-23,.0124,121431e-23,-845284e-16],[.062,.0124,-1.26793e-9,4.22642e-10],[.124,.0124,5.07171e-9,-1.60604e-9],[.186,.0123999,-1.90189e-8,6.00152e-9],[.248,.0124002,7.10039e-8,-2.24e-8],[.31,.0123992,-2.64997e-7,8.35986e-8],[.372,.0124029,9.88983e-7,-3.11994e-7],[.434,.0123893,-369093e-11,-4.35621e-7],[.4958,.0123198,-102252e-10,-3.45523e-7],[.5571,.0121916,-154081e-10,-5.82288e-7],[.6176,.0119938,-241424e-10,-5.25327e-7],[.6769,.011713,-320223e-10,-5.16405e-7],[.7346,.0113541,-397684e-10,-6.09052e-7],[.7903,.0109107,-489042e-10,-104739e-11],[.8435,.0103431,-64615e-9,-1.40374e-9],[.8936,.00969686,-64636e-9,-8547e-9],[.9394,.00840947,-192841e-9,-42106e-10],[.9761,.00616527,-256e-6,-42106e-10],[1,.00328947,-319159e-9,-42106e-10]],ce=Xt/5,fe=function(t,i){return t[0]+i*(t[1]+i*(t[2]+i*t[3]))};var de={init:function(){this.x0=this.x0||0,this.y0=this.y0||0,this.long0=this.long0||0,this.es=0,this.title=this.title||"Robinson"},forward:function(t){var i=bi(t.x-this.long0),s=Math.abs(t.y),e=Math.floor(s*ce);e<0?e=0:e>=18&&(e=17);var a={x:fe(le[e],s=Xt*(s-.08726646259971647*e))*i,y:fe(ue[e],s)};return t.y<0&&(a.y=-a.y),a.x=a.x*this.a*.8487+this.x0,a.y=a.y*this.a*1.3523+this.y0,a},inverse:function(t){var i={x:(t.x-this.x0)/(.8487*this.a),y:Math.abs(t.y-this.y0)/(1.3523*this.a)};if(i.y>=1)i.x/=le[18][0],i.y=t.y<0?-Qt:Qt;else{var s=Math.floor(18*i.y);for(s<0?s=0:s>=18&&(s=17);;)if(ue[s][0]>i.y)--s;else{if(!(ue[s+1][0]<=i.y))break;++s}var e=ue[s],a=5*(i.y-e[0])/(ue[s+1][0]-e[0]);a=function(t,i,s,e){for(var a=i;e;--e){var n=t(a);if(a-=n,Math.abs(n)<s)break}return a}((function(t){return(fe(e,t)-i.y)/function(t,i){return t[1]+i*(2*t[2]+3*i*t[3])}(e,t)}),a,1e-10,100),i.x/=fe(le[s],a),i.y=(5*s+a)*Wt,t.y<0&&(i.y=-i.y)}return i.x=bi(i.x+this.long0),i},names:["Robinson","robin"]};var Me={init:function(){this.name="geocent"},forward:function(t){return Ti(t,this.es,this.a)},inverse:function(t){return ji(t,this.es,this.a,this.b)},names:["Geocentric","geocentric","geocent","Geocent"]};Vi.defaultDatum="WGS84",Vi.Proj=Ii,Vi.WGS84=new Vi.Proj("WGS84"),Vi.Point=as,Vi.toPoint=Di,Vi.defs=di,Vi.transform=Gi,Vi.mgrs=Xi,Vi.version="__VERSION__",function(t){t.Proj.projections.add(ls),t.Proj.projections.add(ps),t.Proj.projections.add(ms),t.Proj.projections.add(vs),t.Proj.projections.add(bs),t.Proj.projections.add(_s),t.Proj.projections.add(xs),t.Proj.projections.add(ws),t.Proj.projections.add(Ns),t.Proj.projections.add(Ts),t.Proj.projections.add(qs),t.Proj.projections.add(Fs),t.Proj.projections.add(Ds),t.Proj.projections.add(Ls),t.Proj.projections.add(Gs),t.Proj.projections.add(zs),t.Proj.projections.add(Bs),t.Proj.projections.add(Us),t.Proj.projections.add(Vs),t.Proj.projections.add(Js),t.Proj.projections.add(Qs),t.Proj.projections.add(Ws),t.Proj.projections.add(Xs),t.Proj.projections.add(Hs),t.Proj.projections.add(oe),t.Proj.projections.add(de),t.Proj.projections.add(Me)}(Vi);var pe,me=Object.freeze({__proto__:null,default:Vi}),ge=e((function(t,i){function s(t,i,s){void 0===s&&(s={});var e={type:"Feature"};return(0===s.id||s.id)&&(e.id=s.id),s.bbox&&(e.bbox=s.bbox),e.properties=i||{},e.geometry=t,e}function e(t,i,e){return void 0===e&&(e={}),s({type:"Point",coordinates:t},i,e)}function a(t,i,e){void 0===e&&(e={});for(var a=0,n=t;a<n.length;a++){var r=n[a];if(r.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var h=0;h<r[r.length-1].length;h++)if(r[r.length-1][h]!==r[0][h])throw new Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:t},i,e)}function n(t,i,e){if(void 0===e&&(e={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return s({type:"LineString",coordinates:t},i,e)}function r(t,i){void 0===i&&(i={});var s={type:"FeatureCollection"};return i.id&&(s.id=i.id),i.bbox&&(s.bbox=i.bbox),s.features=t,s}function h(t,i,e){return void 0===e&&(e={}),s({type:"MultiLineString",coordinates:t},i,e)}function o(t,i,e){return void 0===e&&(e={}),s({type:"MultiPoint",coordinates:t},i,e)}function l(t,i,e){return void 0===e&&(e={}),s({type:"MultiPolygon",coordinates:t},i,e)}function u(t,s){void 0===s&&(s="kilometers");var e=i.factors[s];if(!e)throw new Error(s+" units is invalid");return t*e}function c(t,s){void 0===s&&(s="kilometers");var e=i.factors[s];if(!e)throw new Error(s+" units is invalid");return t/e}function f(t){return 180*(t%(2*Math.PI))/Math.PI}function d(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)&&!/^\s*$/.test(t)}Object.defineProperty(i,"__esModule",{value:!0}),i.earthRadius=6371008.8,i.factors={centimeters:100*i.earthRadius,centimetres:100*i.earthRadius,degrees:i.earthRadius/111325,feet:3.28084*i.earthRadius,inches:39.37*i.earthRadius,kilometers:i.earthRadius/1e3,kilometres:i.earthRadius/1e3,meters:i.earthRadius,metres:i.earthRadius,miles:i.earthRadius/1609.344,millimeters:1e3*i.earthRadius,millimetres:1e3*i.earthRadius,nauticalmiles:i.earthRadius/1852,radians:1,yards:i.earthRadius/1.0936},i.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/i.earthRadius,yards:1/1.0936},i.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},i.feature=s,i.geometry=function(t,i,s){switch(t){case"Point":return e(i).geometry;case"LineString":return n(i).geometry;case"Polygon":return a(i).geometry;case"MultiPoint":return o(i).geometry;case"MultiLineString":return h(i).geometry;case"MultiPolygon":return l(i).geometry;default:throw new Error(t+" is invalid")}},i.point=e,i.points=function(t,i,s){return void 0===s&&(s={}),r(t.map((function(t){return e(t,i)})),s)},i.polygon=a,i.polygons=function(t,i,s){return void 0===s&&(s={}),r(t.map((function(t){return a(t,i)})),s)},i.lineString=n,i.lineStrings=function(t,i,s){return void 0===s&&(s={}),r(t.map((function(t){return n(t,i)})),s)},i.featureCollection=r,i.multiLineString=h,i.multiPoint=o,i.multiPolygon=l,i.geometryCollection=function(t,i,e){return void 0===e&&(e={}),s({type:"GeometryCollection",geometries:t},i,e)},i.round=function(t,i){if(void 0===i&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var s=Math.pow(10,i||0);return Math.round(t*s)/s},i.radiansToLength=u,i.lengthToRadians=c,i.lengthToDegrees=function(t,i){return f(c(t,i))},i.bearingToAzimuth=function(t){var i=t%360;return i<0&&(i+=360),i},i.radiansToDegrees=f,i.degreesToRadians=function(t){return t%360*Math.PI/180},i.convertLength=function(t,i,s){if(void 0===i&&(i="kilometers"),void 0===s&&(s="kilometers"),!(t>=0))throw new Error("length must be a positive number");return u(c(t,i),s)},i.convertArea=function(t,s,e){if(void 0===s&&(s="meters"),void 0===e&&(e="kilometers"),!(t>=0))throw new Error("area must be a positive number");var a=i.areaFactors[s];if(!a)throw new Error("invalid original units");var n=i.areaFactors[e];if(!n)throw new Error("invalid final units");return t/a*n},i.isNumber=d,i.isObject=function(t){return!!t&&t.constructor===Object},i.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!d(t))throw new Error("bbox must only contain numbers")}))},i.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")},i.radians2degrees=function(){throw new Error("method has been renamed to `radiansToDegrees`")},i.degrees2radians=function(){throw new Error("method has been renamed to `degreesToRadians`")},i.distanceToDegrees=function(){throw new Error("method has been renamed to `lengthToDegrees`")},i.distanceToRadians=function(){throw new Error("method has been renamed to `lengthToRadians`")},i.radiansToDistance=function(){throw new Error("method has been renamed to `radiansToLength`")},i.bearingToAngle=function(){throw new Error("method has been renamed to `bearingToAzimuth`")},i.convertDistance=function(){throw new Error("method has been renamed to `convertLength`")}}));(pe=ge)&&pe.__esModule&&Object.prototype.hasOwnProperty.call(pe,"default")&&pe.default;ge.earthRadius,ge.factors,ge.unitsFactors,ge.areaFactors,ge.feature,ge.geometry,ge.point,ge.points,ge.polygon,ge.polygons,ge.lineString,ge.lineStrings,ge.featureCollection,ge.multiLineString,ge.multiPoint,ge.multiPolygon,ge.geometryCollection,ge.round,ge.radiansToLength,ge.lengthToRadians,ge.lengthToDegrees,ge.bearingToAzimuth,ge.radiansToDegrees,ge.degreesToRadians,ge.convertLength,ge.convertArea,ge.isNumber,ge.isObject,ge.validateBBox,ge.validateId,ge.radians2degrees,ge.degrees2radians,ge.distanceToDegrees,ge.distanceToRadians,ge.radiansToDistance,ge.bearingToAngle,ge.convertDistance;var ye={getSafe(t,i){try{return t()}catch(t){return i||""}}},ve=a(me);ve.defs("EPSG:25832","+proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs");const be=new ve.Proj("EPSG:25832"),_e=new ve.Proj("WGS84");var xe={parseXML(t){if(!ct.validate(t))throw new Error("Invalid XML structure.");const i=ct.parse(t),s={applicationYear:ye.getSafe(()=>i.nn.antragsjahr),farmId:ye.getSafe(()=>i.nn.bnrzd),state:ye.getSafe(()=>i.nn.land.bezeichnung),fieldBlockConstant:ye.getSafe(()=>i.nn.land.feldblockkonstante),stateNo:ye.getSafe(()=>i.nn.land.nummer)};if(ye.getSafe(()=>i.nn.land.parzelle))return Array.isArray(i.nn.land.parzelle)||(i.nn.land.parzelle=[i.nn.land.parzelle]),i.nn.land.parzelle.map(t=>Object.assign(JSON.parse(JSON.stringify(s)),t));throw new Error("No fields found in XML.")},parseGML(t){if(!ct.validate(t))throw new Error("Invalid GML structure.");function i(t){this.schlag=t.schlag,this.schlag.nummer=t.schlag.nummer,this.geometry=t.geometry}let s=ct.parse(t)["wfs:FeatureCollection"]["gml:featureMember"];if(ye.getSafe(()=>s)){let t=[];return Array.isArray(s)||(s=[s]),s.forEach(s=>{const e=ye.getSafe(()=>s["elan:tschlag"]["elan:SCHLAGNR"]),a=ye.getSafe(()=>s["elan:tschlag"]["elan:WIRTSCHAFTSJAHR"]);let n=ye.getSafe(()=>s["elan:tschlag"]["elan:GEO_COORD_"]["gml:Polygon"]["gml:outerBoundaryIs"]["gml:LinearRing"]["gml:coordinates"]);if(!n)return;n=n.split(" "),n=n.map(t=>t.split(",").map(t=>Number(t))),n=n.map(t=>ve(be,_e,t));const r=new i({schlag:{nummer:e},geometry:ge.polygon([n],{number:e,year:a})});t.push(JSON.parse(JSON.stringify(r)))}),t}throw new Error("No fields found in GML.")},join:(t,i)=>t.map(t=>{const s=i.find(i=>i.schlag.nummer===t.schlag.nummer);return s?(t.geometry=s.geometry,JSON.parse(JSON.stringify(t))):JSON.parse(JSON.stringify(t))})};a(Vt);var we,Ne=(we=ve)&&"object"===t(we)&&"default"in we?we.default:we,Ce=function(t){return ct.parse(t,null,!0)},Pe=function(t,i){return xe.join(xe.parseXML(t),xe.parseGML(i))};Ne.defs("EPSG:25832","+proj=utm +zone=32 +ellps=GRS80 +units=m +no_defs");var Se=new Ne.Proj("EPSG:25832"),Ae=new Ne.Proj("WGS84"),Ee={toLetter:function(t){return!isNaN(t)&&t>=0&&t<=26?"abcdefghijklmnopqrstuvwxyz".split("")[t]:"a"},toGeoJSON:function(t){var i=this,s=Ce(t.replace(/&lt;/g,"<").replace(/&gt;/g,">")),e=this.flatten(s),a=Object.keys(e).map((function(t){return i.toCoordinates(e[t])}));return ge.multiPolygon(a)},toPairs:function(t){return t.reduce((function(t,i,s,e){return s%2==0&&t.push(e.slice(s,s+2)),t}),[])},toCoordinates:function(t,i){var s=t.split(/\s+/g).map((function(t){return Number(t)})),e=this.toPairs(s);return i||(e=e.map((function(t){return Ne(Se,Ae,t)}))),e},flatten:function(i){var s={};for(var e in i)if(e in i)if("object"===t(i[e])){var a=this.flatten(i[e]);for(var n in a)n in a&&(s[e+"."+n]=a[n])}else s[e]=i[e];return s}};function Oe(t,i){return i.reduce((function(i,s){return s in t?"":i+"Missing property ".concat(s," for state ").concat(t.state,". ")}),"")}var ke=function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.id=i.id||"String",this.referenceDate=i.referenceDate,this.NameOfField=i.NameOfField||"Unbenannt ".concat(i.NumberOfField),this.NumberOfField=i.NumberOfField,this.Area=i.Area,this.FieldBlockNumber=i.FieldBlockNumber,this.PartOfField=i.PartOfField,this.SpatialData=i.SpatialData,this.LandUseRestriction=i.LandUseRestriction,this.Cultivation=i.Cultivation};function Ie(t){return Te.apply(this,arguments)}function Te(){return(Te=s(regeneratorRuntime.mark((function t(i){var s,e,a,n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(s=Oe(i,["xml"]))){t.next=3;break}throw new Error(s);case 3:return e=Ce(i.xml),a=e["fa:flaechenantrag"]["fa:xsd_info"]["fa:xsd_jahr"],n=e["fa:flaechenantrag"]["fa:gesamtparzellen"]["fa:gesamtparzelle"],r=0,t.abrupt("return",n.reduce((function(t,i){var s=i["fa:teilflaechen"]["fa:hauptnutzungsflaeche"];t.push(new ke({id:"harmonie_".concat(r,"_").concat(s["fa:flik"]),referenceDate:a,NameOfField:"",NumberOfField:Math.floor(s["fa:teilflaechennummer"]),Area:s["fa:groesse"],FieldBlockNumber:s["fa:flik"],PartOfField:"a",SpatialData:Ee.toGeoJSON(s["fa:geometrie"]),LandUseRestriction:"",Cultivation:{PrimaryCrop:{CropSpeciesCode:s["fa:nutzung"],Name:""},CatchCrop:{CropSpeciesCode:"",Name:""},PrecedingCrop:{CropSpeciesCode:"",Name:""}}})),r++;var e=i["fa:teilflaechen"]["fa:streifen_flaechen"];return e?(Array.isArray(e["fa:streifen"])||(e["fa:streifen"]=[e["fa:streifen"]]),e["fa:streifen"].forEach((function(i,s){r++,t.push(new ke({id:"harmonie_".concat(r,"_").concat(i["fa:flik"]),referenceDate:a,NameOfField:"",NumberOfField:Math.floor(i["fa:teilflaechennummer"]),Area:i["fa:groesse"],FieldBlockNumber:i["fa:flik"],PartOfField:Ee.toLetter(s+1),SpatialData:Ee.toGeoJSON(i["fa:geometrie"]),LandUseRestriction:"",Cultivation:{PrimaryCrop:{CropSpeciesCode:i["fa:nutzung"],Name:""},CatchCrop:{CropSpeciesCode:"",Name:""},PrecedingCrop:{CropSpeciesCode:"",Name:""}}}))})),t):t}),[]));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function je(){return(je=s(regeneratorRuntime.mark((function t(i){var s,e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(s=Oe(i,["xml","gml"]))){t.next=3;break}throw new Error(s);case 3:return e=Pe(i.xml,i.gml),t.abrupt("return",e.map((function(t,i){return new ke({id:"harmonie_".concat(i,"_").concat(t.feldblock),referenceDate:t.applicationYear,NameOfField:t.schlag.bezeichnung,NumberOfField:t.schlag.nummer,Area:t.nettoflaeche,FieldBlockNumber:t.feldblock,PartOfField:t.teilschlag,SpatialData:t.geometry,LandUseRestriction:"",Cultivation:{PrimaryCrop:{CropSpeciesCode:t.nutzungaj.code,Name:t.nutzungaj.bezeichnung},CatchCrop:{CropSpeciesCode:"1"===t.greeningcode?50:"",Name:"1"===t.greeningcode?"Mischkulturen Saatgutmischung":""},PrecedingCrop:{CropSpeciesCode:t.nutzungvj.code,Name:t.nutzungvj.bezeichnung}}})})));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return function(t){var i=t.state;if(!i)throw new Error('No property "state" given, required to be in ISO 3166-2 UTF-8 string format (e.g. "DE-NW")');switch(i){case"DE-BB":case"DE-MV":return Ie(t);case"DE-NW":return function(t){return je.apply(this,arguments)}(t);default:throw new Error('No such state as "'.concat(i,'" according to ISO 3166-2 in Germany."'))}}}));
